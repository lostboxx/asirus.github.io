<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="HEX –†–µ–¥–∞–∫—Ç–æ—Ä –æ—Ç Asirus - –†–µ–¥–∞–∫—Ç–æ—Ä, –≥–¥–µ –º–æ–∂–Ω–æ –Ω–∞–ø—Ä—è–º—É—é –∏–∑–º–µ–Ω–∏—Ç—å –±–∞–π—Ç—ã —Ñ–∞–π–ª–∞!" />
  <meta name="keywords" content="HEX —Ä–µ–¥–∞–∫—Ç–æ—Ä, –æ–Ω–ª–∞–π–Ω hex —Ä–µ–¥–∞–∫—Ç–æ—Ä, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –±–∞–π—Ç—ã, —à–µ—Å—Ç–Ω–∞–¥—Ü–∞—Ç–µ—Ä–∏—á–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä, hex tool, hex editor">
  <link rel="icon" href="/res/img/favicon.png" type="image/png" size="32x32" />
  <title>HEX –†–µ–¥–∞–∫—Ç–æ—Ä</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    html, body {
      width: 100%;
      min-height: 100vh; 
      overflow-x: hidden;
      font-size: 16px; 
    }

    body {
      display: block;
      background: #f0f0f0;
      padding: 0px; 
    }

    header {
      background: #4a76a8;
      color: #fff;
      width: 100%;
      height: 60px; 
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      font-size: 1.5rem; 
      font-weight: 600;
      border-bottom: 2px solid #3a5a80;
      flex-shrink: 0;
      margin-bottom: 10px; 
    }

    main {
      width: 100%;
      max-width: 900px;
      margin: 0 auto; 
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 15px; 
      gap: 12px; 
      padding-bottom: 120px;
    }

    .file-input-container {
      position: relative;
      display: inline-block;
      width: 60%;
      margin: 10px 0;
    }

    .file-input-button {
      width: 100%;
      padding: 10px;
      background: white;
      border: 1px dashed #4a76a8;
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 1rem;
      text-align: center;
      color: #333;
      pointer-events: none; /* –û—Ç–∫–ª—é—á–∞–µ–º —Å–æ–±—ã—Ç–∏—è –º—ã—à–∏ –¥–ª—è —Å–∞–º–æ–π –∫–Ω–æ–ø–∫–∏ */
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100%;
      line-height: 1.2; /* –£–ª—É—á—à–∞–µ–º –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ */
    }

    .file-input-button:hover {
      background: #f0f0f0;
      border-color: #3a5a80;
    }

    #fileInput {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      opacity: 0;
      cursor: pointer;
    }
    
    textarea {
      width: 100%;
      height: 300px; 
      resize: none;
      font-family: 'Fira Code', 'Consolas', monospace;
      font-size: 14px; 
      margin: 10px 0; 
      padding: 12px; 
      border: 1px solid #ccc; 
      border-radius: 4px; 
      background: #fafafa;
      box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1); 
      line-height: 1.4; 
    }

    textarea:focus {
      outline: none;
      border-color: #4a76a8;
      box-shadow: inset 0 1px 2px rgba(74, 118, 168, 0.1);
    }

    .info {
      margin: 10px 0; 
      padding: 12px; 
      background: white;
      border-radius: 4px; 
      width: 100%;
      text-align: center;
      font-size: 1rem; 
      border: 1px solid #ddd; 
      border-left: 4px solid #4a76a8; 
      line-height: 1.5; 
    }

    .valid {
      color: #4caf50;
      font-weight: bold;
      font-size: 0.9rem; 
    }

    .invalid {
      color: #f44336;
      font-weight: bold;
      font-size: 0.9rem;
    }

    .loading {
      color: #ff9800;
      font-weight: bold;
      font-size: 0.9rem;
    }

    .extension-info {
      background: #e3f2fd;
      border-left: 2px solid #2196f3;
      padding: 8px 10px;
      margin: 8px 0;
      font-size: 0.9rem;
      border-radius: 3px;
      line-height: 1.4;
    }

    .buttons-container {
      width: 100%;
      max-width: 900px;
      padding: 0 15px 15px; 
      position: fixed;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(transparent 0%, #f0f0f0 15%);
      z-index: 100;
    }

    .buttons {
      display: flex;
      gap: 8px; 
      flex-wrap: wrap;
      justify-content: center;
      width: 100%;
      background: white;
      padding: 10px; 
      border: 1px solid #ddd;
    }
    
    .buts {
      padding: 8px 15px; 
      background: #4a76a8;
      color: white;
      border: 1px solid #3a5a80;
      border-radius: 4px; 
      cursor: pointer;
      font-weight: 500;
      font-size: 0.9rem; 
      transition: all 0.15s ease; 
      white-space: nowrap;
      flex: 1;
      min-width: 70px; 
      max-width: 120px; 
      display: flex;
      justify-content: center;
      align-items: center;
      height: 36px; 
    }

    button:hover {
      background: #3a5a80;
    }

    button:active {
      background: #2a4a70;
    }

    button:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }

    @media (max-width: 768px) {
      html, body {
        font-size: 15px;
      }
      
      .buttons {
        padding: 8px;
        gap: 6px;
      }
      
      button {
        flex: 1 0 calc(50% - 6px);
        min-width: 60px;
        max-width: calc(50% - 6px);
        padding: 6px 10px;
        font-size: 0.85rem;
        height: 32px;
      }
      
      .buttons-container {
        padding: 0 12px 12px;
      }
      
      textarea {
        height: 250px;
        font-size: 13px;
      }
      
      header {
        font-size: 1.3rem;
        height: 55px;
      }
      
      main {
        padding: 12px;
        gap: 10px;
      }
      
      .file-input-container {
        width: 80%;
      }
    }

    @media (max-width: 400px) {
      html, body {
        font-size: 14px;
      }
      
      button {
        flex: 1 0 calc(50% - 5px);
        min-width: 55px;
        max-width: calc(50% - 5px);
        padding: 5px 8px;
        font-size: 0.8rem;
        height: 30px;
      }
      
      .buttons {
        gap: 5px;
        padding: 8px;
      }
      
      textarea {
        height: 220px;
        font-size: 12px;
      }
      
      header {
        font-size: 1.2rem;
        height: 50px;
      }
      
      .file-input-container {
        width: 90%;
      }
    }

    @media (min-width: 769px) {
      .buttons {
        flex-wrap: nowrap;
      }
      
      button {
        flex: 1;
        min-width: 70px;
        max-width: 140px;
        height: 36px;
      }
    }

    .preview-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.2s ease;
    }

    .preview-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .preview-container {
      background: white;
      border-radius: 4px;
      width: 95%; /* –£–≤–µ–ª–∏—á–µ–Ω–∞ —à–∏—Ä–∏–Ω–∞ */
      max-width: 800px; /* –£–≤–µ–ª–∏—á–µ–Ω –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä */
      max-height: 85%; /* –£–≤–µ–ª–∏—á–µ–Ω–∞ –≤—ã—Å–æ—Ç–∞ */
      overflow: hidden;
      border: 1px solid #ccc;
      display: flex;
      flex-direction: column;
    }

    .preview-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 16px;
      background: #4a76a8;
      color: white;
      border-bottom: 1px solid #3a5a80;
    }

    .preview-title {
      font-weight: 600;
      font-size: 1.1rem;
    }

    .preview-close {
      background: none;
      border: none;
      color: white;
      font-size: 1.3rem;
      cursor: pointer;
      width: 28px;
      height: 28px;
      display: flex;
      justify-content: center;
      align-items: center;
      border-radius: 50%;
      transition: background 0.15s ease;
    }

    .preview-close:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .preview-content {
      padding: 15px;
      overflow: auto;
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 400px; /* –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
    }

    .preview-text {
      white-space: pre-wrap;
      font-family: monospace;
      background: #f8f9fa;
      padding: 12px;
      border-radius: 4px;
      max-height: 500px; /* –£–≤–µ–ª–∏—á–µ–Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ */
      overflow: auto;
      width: 100%;
      font-size: 0.9rem;
      line-height: 1.4;
      border: 1px solid #ddd;
    }

    .preview-image {
      max-width: 100%;
      max-height: 500px; /* –£–≤–µ–ª–∏—á–µ–Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ */
      border-radius: 4px;
    }

    .preview-video {
      max-width: 100%;
      max-height: 500px; /* –£–≤–µ–ª–∏—á–µ–Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ */
      border-radius: 4px;
    }

    .preview-audio {
      width: 100%;
      margin: 15px 0;
    }

    .preview-unsupported {
      padding: 20px;
      text-align: center;
      color: #6c757d;
      font-size: 0.95rem;
    }

    .preview-controls {
      display: flex;
      gap: 10px;
      padding: 10px 16px;
      background: #f5f5f5;
      border-bottom: 1px solid #ddd;
    }

    .preview-mode-btn {
      padding: 6px 12px;
      background: #e9ecef;
      border: 1px solid #ced4da;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.85rem;
      transition: all 0.15s ease;
    }

    .preview-mode-btn.active {
      background: #4a76a8;
      color: white;
      border-color: #3a5a80;
    }

    .preview-html-frame {
      width: 100%;
      height: 600px; /* –£–≤–µ–ª–∏—á–µ–Ω–∞ –≤—ã—Å–æ—Ç–∞ –¥–ª—è HTML */
      border: none;
      background: white;
    }

    @supports (padding: max(0px)) {
      .buttons-container {
        padding-bottom: max(15px, env(safe-area-inset-bottom));
      }
    }

    main {
      scroll-behavior: smooth;
    }
    
    details ol {
      padding: 20px;
    }
    
    .lang-container {
      position: fixed;
      bottom: 10px;
      right: 10px;
      display: flex;
      gap: 5px;
      z-index: 101;
    }
    
    .lang {
      width: 30px;
      height: 30px;
      overflow: hidden;
      font-size: 24px;
      display: flex;
      justify-content: center;
      align-items: center;
      background: white;
      border: 1px solid #ccc;
      border-radius: 4px;
      cursor: pointer;
    }
    
    .lang:hover {
      background: #f0f0f0;
    }
    
    .lang.active {
      border: 2px solid #4a76a8;
    }
    
    hr {
      width: 90%;
      border: 0;
      border-top: 1px solid #ddd;
      margin: 15px 0;
    }
    
    details {
      width: 100%;
      margin: 10px 0;
      border: 1px solid #ddd;
      border-radius: 4px;
      background: white;
    }
    
    details summary {
      padding: 12px 15px;
      cursor: pointer;
      font-weight: 600;
      background: #f5f5f5;
      border-bottom: 1px solid #ddd;
    }
    
    details[open] summary {
      border-bottom: 1px solid #ddd;
    }
    
    details ol, details ul {
      padding: 15px 30px;
    }
    
    details li {
      margin: 8px 0;
    }
    
    .fullscreen-btn {
      margin: 20px auto;
      padding: 8px 16px;
      background: #4a76a8;
      color: white;
      border: 1px solid #3a5a80;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 500;
      font-size: 0.9rem;
      transition: all 0.15s ease;
      display: block;
      text-align: center;
      max-width: 150px;
    }
    
    .fullscreen-btn:hover {
      background: #3a5a80;
    }
    
    body.fullscreen {
      padding: 0;
    }
    
    body.fullscreen header {
      margin-bottom: 0;
    }
    
    body.fullscreen main {
      max-width: 100%;
      padding: 10px;
      padding-bottom: 80px;
    }
    
    body.fullscreen textarea {
      height: calc(100vh - 200px);
    }
    
    body.fullscreen .buttons-container {
      max-width: 100%;
    }
  </style>
</head>
<body>
  <header data-i18n="title">HEX Editor</header>
  <main>
    <div class="file-input-container">
      <button class="file-input-button" data-i18n="loadFile">Load File</button>
      <input type="file" id="fileInput">
    </div>
    <textarea id="hexArea" placeholder="HEX data..." data-i18n-placeholder="hexPlaceholder"></textarea>
    <div class="info" id="fileInfo" data-i18n="selectFile">Select a file or enter HEX data</div>
    <div class="buttons">
      <button class="buts" id="checkBtn" data-i18n="check">Check</button>
      <button class="buts" id="previewBtn" data-i18n="preview">Preview</button>
      <button class="buts" id="downloadBtn" data-i18n="download">Download</button>
      <button class="buts" id="clearBtn" data-i18n="clear">Clear</button>
    </div>
    <hr>
    <details>
      <summary><h3 data-i18n="instructionTitle">HEX Editor Instructions</h3></summary>
      <ol>
        <li data-i18n="instruction1">Click "Load file" at the top to upload a file.</li>
        <br>
        <li data-i18n="instruction2">You will see a field with hexadecimal data.</li>
        <br>
        <li data-i18n="instruction3">You can modify bytes in the field, but do not touch the first bytes - without them the file will be marked as invalid.</li>
        <br>
        <li data-i18n="instruction4">Click "Check" to determine the file type.</li>
        <br>
        <li data-i18n="instruction5">Click "Preview" to preview the file if it's a photo/audio/video.</li>
        <br>
        <li data-i18n="instruction8">For HTML files, you can switch between "Text" and "Page" modes in the preview window.</li>
        <br>
        <li data-i18n="instruction6">Click "Download" to download the modified file.</li>
        <br>
        <li data-i18n="instruction7">Click "Clear" to clear the field of bytes.</li>
        <br>
        <li data-i18n="instruction9">Use "Fullscreen Mode" button at the bottom to toggle fullscreen editing.</li>
      </ol>
    </details>
    <details>
      <summary><h3 data-i18n="purposeTitle">What is a "HEX Editor" for?</h3></summary>
      <ul>
        <li data-i18n="purpose1">"HEX Editor" is primarily needed for low-level file editing at the byte level.</li>
        <br>
        <li data-i18n="purpose2">In the "HEX Editor" you can get acquainted with bytes for the first time.</li>
        <br>
        <li data-i18n="purpose3">This "HEX Editor" has been simplified for better performance. If you need a powerful editor, it is recommended to visit <a href="https://www.sweetscape.com/010editor/?hl=ru-RU">010 editor</a> or <a href="https://hexed.it/">Hexed IT</a>.</li>
      </ul>
    </details>
    
    <!-- Fullscreen button -->
    <button class="fullscreen-btn" id="fullscreenBtn" data-i18n="fullscreen">Fullscreen Mode</button>
  </main>
  
  <!-- Language selector -->
  <div class="lang-container">
    <button class="lang" id="langRu">üá∑üá∫</button>
    <button class="lang active" id="langEn">üá¨üáß</button>
  </div>
  
  <!-- Preview window -->
  <div class="preview-overlay" id="previewOverlay">
    <div class="preview-container">
      <div class="preview-header">
        <div class="preview-title" data-i18n="previewTitle">File Preview</div>
        <button class="preview-close" id="previewClose">√ó</button>
      </div>
      <div class="preview-controls" id="previewControls" style="display: none;">
        <button class="preview-mode-btn active" id="previewModeText" data-i18n="previewText">Text</button>
        <button class="preview-mode-btn" id="previewModePage" data-i18n="previewPage">Page</button>
      </div>
      <div class="preview-content" id="previewContent">
        <div class="preview-unsupported" data-i18n="previewUnavailable">Preview not available</div>
      </div>
    </div>
  </div>

  <script>
    // Language support
    const translations = {
      'ru': {
        'title': 'HEX –†–µ–¥–∞–∫—Ç–æ—Ä',
        'loadFile': '–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª',
        'hexPlaceholder': 'HEX –¥–∞–Ω–Ω—ã–µ...',
        'selectFile': '–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ HEX –¥–∞–Ω–Ω—ã–µ',
        'check': '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å',
        'preview': '–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä',
        'download': '–°–∫–∞—á–∞—Ç—å',
        'clear': '–û—á–∏—Å—Ç–∏—Ç—å',
        'instructionTitle': '–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ä–∞–±–æ—Ç–µ —Å HEX –†–µ–¥–∞–∫—Ç–æ—Ä–æ–º',
        'instruction1': '–ù–∞–∂–º–∏—Ç–µ ¬´–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª¬ª —Å–≤–µ—Ä—Ö—É, —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª.',
        'instruction2': '–ü–µ—Ä–µ–¥ –≤–∞–º–∏ –ø–æ–ª–µ —Å —à–µ—Å—Ç–Ω–∞–¥—Ü–∞—Ç–µ—Ä–∏—á–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º.',
        'instruction3': '–í—ã –º–æ–∂–µ—Ç–µ –∏–∑–º–µ–Ω—è—Ç—å –±–∞–π—Ç—ã –≤ –ø–æ–ª–µ, –Ω–æ –Ω–µ —Ç—Ä–æ–≥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–µ –±–∞–π—Ç—ã - –±–µ–∑ –Ω–∏—Ö —Ñ–∞–π–ª –±—É–¥–µ—Ç –ø–æ–º–µ—á–µ–Ω –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º.',
        'instruction4': '–ù–∞–∂–º–∏—Ç–µ ¬´–ü—Ä–æ–≤–µ—Ä–∏—Ç—å¬ª —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å —Ç–∏–ø —Ñ–∞–π–ª–∞.',
        'instruction5': '–ù–∞–∂–º–∏—Ç–µ ¬´–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä¬ª —á—Ç–æ–±—ã –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ñ–∞–π–ª, –µ—Å–ª–∏ –æ–Ω —Ñ–æ—Ç–æ/–∞—É–¥–∏–æ/–≤–∏–¥–µ–æ.',
        'instruction6': '–ù–∞–∂–º–∏—Ç–µ ¬´–°–∫–∞—á–∞—Ç—å¬ª —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–π —Ñ–∞–π–ª.',
        'instruction7': '–ù–∞–∂–º–∏—Ç–µ ¬´–û—á–∏—Å—Ç–∏—Ç—å¬ª —á—Ç–æ–±—ã –æ—á–∏—Å—Ç–∏—Ç—å –ø–æ–ª–µ –æ—Ç –±–∞–π—Ç–æ–≤.',
        'instruction8': '–î–ª—è HTML —Ñ–∞–π–ª–æ–≤ –≤ –æ–∫–Ω–µ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É —Ä–µ–∂–∏–º–∞–º–∏ "–¢–µ–∫—Å—Ç" –∏ "–°—Ç—Ä–∞–Ω–∏—Ü–∞".',
        'instruction9': '–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É "–ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º" –≤–Ω–∏–∑—É –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.',
        'purposeTitle': '–ó–∞—á–µ–º –Ω—É–∂–µ–Ω ¬´HEX —Ä–µ–¥–∞–∫—Ç–æ—Ä¬ª?',
        'purpose1': '¬´HEX —Ä–µ–¥–∞–∫—Ç–æ—Ä¬ª –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å –Ω—É–∂–µ–Ω –¥–ª—è –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –Ω–∞ —É—Ä–æ–≤–Ω–µ –±–∞–π—Ç–æ–≤.',
        'purpose2': '–í ¬´HEX —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ¬ª –º–æ–∂–Ω–æ –≤–ø–µ—Ä–≤—ã–µ –æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å –±–∞–π—Ç–∞–º–∏',
        'purpose3': '–î–∞–Ω–Ω—ã–π ¬´HEX —Ä–µ–¥–∞–∫—Ç–æ—Ä¬ª –±—ã–ª —É–ø—Ä–æ—â—ë–Ω –¥–ª—è –ª—É—á—à–µ–π —Ä–∞–±–æ—Ç—ã. –ï—Å–ª–∏ –≤–∞–º –Ω—É–∂–µ–Ω –º–æ—â–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä, —Å–æ–≤–µ—Ç—É–µ—Ç—Å—è –∑–∞–π—Ç–∏ –Ω–∞ <a href="https://www.sweetscape.com/010editor/?hl=ru-RU">010 editor</a> –∏–ª–∏ <a href="https://hexed.it/">Hexed IT</a>.',
        'previewTitle': '–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ñ–∞–π–ª–∞',
        'previewUnavailable': '–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω',
        'previewText': '–¢–µ–∫—Å—Ç',
        'previewPage': '–°—Ç—Ä–∞–Ω–∏—Ü–∞',
        'fullscreen': '–ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º',
        'normalScreen': '–û–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º',
        'loading': '–ó–∞–≥—Ä—É–∑–∫–∞...',
        'fileLoaded': '–§–∞–π–ª —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω',
        'originalName': '–ò—Å—Ö–æ–¥–Ω–æ–µ –∏–º—è',
        'size': '–†–∞–∑–º–µ—Ä',
        'detectedType': '–û–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π —Ç–∏–ø',
        'category': '–ö–∞—Ç–µ–≥–æ—Ä–∏—è',
        'recommendedExt': '–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ',
        'noData': '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏',
        'invalidHex': '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ HEX –¥–∞–Ω–Ω—ã–µ',
        'unknownType': '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø —Ñ–∞–π–ª–∞',
        'downloadSuccess': '–§–∞–π–ª —É—Å–ø–µ—à–Ω–æ —Å–∫–∞—á–∞–Ω:',
        'loadError': '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞',
        'fileCharacteristics': '–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ —Ñ–∞–π–ª–∞',
        'hexLength': '–î–ª–∏–Ω–∞ HEX –¥–∞–Ω–Ω—ã—Ö',
        'byteCount': '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–π—Ç',
        'fileSignature': '–°–∏–≥–Ω–∞—Ç—É—Ä–∞ —Ñ–∞–π–ª–∞',
        'mimeType': 'MIME-—Ç–∏–ø',
        'fileDescription': '–û–ø–∏—Å–∞–Ω–∏–µ —Ñ–∞–π–ª–∞',
        'validity': '–í–∞–ª–∏–¥–Ω–æ—Å—Ç—å',
        'valid': '–í–∞–ª–∏–¥–Ω–æ',
        'invalid': '–ù–µ–≤–∞–ª–∏–¥–Ω–æ',
        'fileDate': '–î–∞—Ç–∞ —Ñ–∞–π–ª–∞',
        'exifData': 'EXIF –¥–∞–Ω–Ω—ã–µ'
      },
      'en': {
        'title': 'HEX Editor',
        'loadFile': 'Load File',
        'hexPlaceholder': 'HEX data...',
        'selectFile': 'Select a file or enter HEX data',
        'check': 'Check',
        'preview': 'Preview',
        'download': 'Download',
        'clear': 'Clear',
        'instructionTitle': 'HEX Editor Instructions',
        'instruction1': 'Click "Load file" at the top to upload a file.',
        'instruction2': 'You will see a field with hexadecimal data.',
        'instruction3': 'You can modify bytes in the field, but do not touch the first bytes - without them the file will be marked as invalid.',
        'instruction4': 'Click "Check" to determine the file type.',
        'instruction5': 'Click "Preview" to preview the file if it\'s a photo/audio/video.',
        'instruction6': 'Click "Download" to download the modified file.',
        'instruction7': 'Click "Clear" to clear the field of bytes.',
        'instruction8': 'For HTML files, you can switch between "Text" and "Page" modes in the preview window.',
        'instruction9': 'Use "Fullscreen Mode" button at the bottom to toggle fullscreen editing.',
        'purposeTitle': 'What is a "HEX Editor" for?',
        'purpose1': '"HEX Editor" is primarily needed for low-level file editing at the byte level.',
        'purpose2': 'In the "HEX Editor" you can get acquainted with bytes for the first time.',
        'purpose3': 'This "HEX Editor" has been simplified for better performance. If you need a powerful editor, it is recommended to visit <a href="https://www.sweetscape.com/010editor/?hl=ru-RU">010 editor</a> or <a href="https://hexed.it/">Hexed IT</a>.',
        'previewTitle': 'File Preview',
        'previewUnavailable': 'Preview not available',
        'previewText': 'Text',
        'previewPage': 'Page',
        'fullscreen': 'Fullscreen Mode',
        'normalScreen': 'Normal Mode',
        'loading': 'Loading...',
        'fileLoaded': 'File loaded successfully',
        'originalName': 'Original name',
        'size': 'Size',
        'detectedType': 'Detected type',
        'category': 'Category',
        'recommendedExt': 'Recommended extension',
        'noData': 'No data to process',
        'invalidHex': 'Invalid HEX data',
        'unknownType': 'Unknown file type',
        'downloadSuccess': 'File successfully downloaded:',
        'loadError': 'Error loading file',
        'fileCharacteristics': 'File characteristics',
        'hexLength': 'HEX data length',
        'byteCount': 'Byte count',
        'fileSignature': 'File signature',
        'mimeType': 'MIME type',
        'fileDescription': 'File description',
        'validity': 'Validity',
        'valid': 'Valid',
        'invalid': 'Invalid',
        'fileDate': 'File date',
        'exifData': 'EXIF data'
      }
    };

    // Language management
    let currentLang = 'en';

    function setLanguage(lang) {
      currentLang = lang;
      localStorage.setItem('hexEditorLang', lang);
      
      // Update active button
      document.getElementById('langRu').classList.toggle('active', lang === 'ru');
      document.getElementById('langEn').classList.toggle('active', lang === 'en');
      
      // Update all translatable elements
      document.querySelectorAll('[data-i18n]').forEach(element => {
        const key = element.getAttribute('data-i18n');
        if (translations[lang][key]) {
          element.innerHTML = translations[lang][key];
        }
      });
      
      // Update placeholders
      document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
        const key = element.getAttribute('data-i18n-placeholder');
        if (translations[lang][key]) {
          element.placeholder = translations[lang][key];
        }
      });
      
      // Update fullscreen button text
      updateFullscreenButtonText();
    }

    // Initialize language
    document.addEventListener('DOMContentLoaded', () => {
      const savedLang = localStorage.getItem('hexEditorLang') || 'en';
      setLanguage(savedLang);
      
      // Language button event listeners
      document.getElementById('langRu').addEventListener('click', () => setLanguage('ru'));
      document.getElementById('langEn').addEventListener('click', () => setLanguage('en'));
    });

    // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    const fileInput = document.getElementById('fileInput');
    const hexArea = document.getElementById('hexArea');
    const fileInfo = document.getElementById('fileInfo');
    const previewBtn = document.getElementById('previewBtn');
    const previewOverlay = document.getElementById('previewOverlay');
    const previewClose = document.getElementById('previewClose');
    const previewContent = document.getElementById('previewContent');
    const previewControls = document.getElementById('previewControls');
    const previewModeText = document.getElementById('previewModeText');
    const previewModePage = document.getElementById('previewModePage');
    const fullscreenBtn = document.getElementById('fullscreenBtn');

    // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–æ–º
    let currentPreviewData = null;
    let currentPreviewType = null;
    let currentPreviewMode = 'text';
    let currentPreviewUrl = null; // –î–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è URL

    // –ë–∞–∑–∞ —Å–∏–≥–Ω–∞—Ç—É—Ä —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è–º–∏ –∏ –æ–ø–∏—Å–∞–Ω–∏—è–º–∏
    const fileSignatures = {
      // –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
      'FFD8FFE0': { type: 'JPEG (JFIF)', ext: 'jpg', category: 'image', mime: 'image/jpeg', description: 'JPEG Image with JFIF metadata' },
      'FFD8FFE1': { type: 'JPEG (EXIF)', ext: 'jpg', category: 'image', mime: 'image/jpeg', description: 'JPEG Image with EXIF metadata' },
      'FFD8FFDB': { type: 'JPEG', ext: 'jpg', category: 'image', mime: 'image/jpeg', description: 'Standard JPEG Image' },
      '89504E470D0A1A0A': { type: 'PNG', ext: 'png', category: 'image', mime: 'image/png', description: 'Portable Network Graphics Image' },
      '474946383761': { type: 'GIF87a', ext: 'gif', category: 'image', mime: 'image/gif', description: 'GIF Image (87a format)' },
      '474946383961': { type: 'GIF89a', ext: 'gif', category: 'image', mime: 'image/gif', description: 'GIF Image (89a format with animations)' },
      '424D': { type: 'BMP', ext: 'bmp', category: 'image', mime: 'image/bmp', description: 'Bitmap Image File' },
      '49492A00': { type: 'TIFF (Little Endian)', ext: 'tiff', category: 'image', mime: 'image/tiff', description: 'TIFF Image (Little Endian)' },
      '4D4D002A': { type: 'TIFF (Big Endian)', ext: 'tiff', category: 'image', mime: 'image/tiff', description: 'TIFF Image (Big Endian)' },

      // –ê—Ä—Ö–∏–≤—ã
      '504B0304': { type: 'ZIP', ext: 'zip', category: 'archive', mime: 'application/zip', description: 'ZIP Archive File' },
      '526172211A0700': { type: 'RAR v1.5+', ext: 'rar', category: 'archive', mime: 'application/vnd.rar', description: 'RAR Archive File' },
      '377ABCAF271C': { type: '7-Zip', ext: '7z', category: 'archive', mime: 'application/x-7z-compressed', description: '7-Zip Archive File' },

      // –ê—É–¥–∏–æ
      '494433': { type: 'MP3 (ID3v2)', ext: 'mp3', category: 'audio', mime: 'audio/mpeg', description: 'MP3 Audio with ID3v2 tags' },
      'FFFB': { type: 'MP3', ext: 'mp3', category: 'audio', mime: 'audio/mpeg', description: 'Standard MP3 Audio File' },
      '464C4143': { type: 'FLAC', ext: 'flac', category: 'audio', mime: 'audio/flac', description: 'Free Lossless Audio Codec' },
      '4F676753': { type: 'OGG', ext: 'ogg', category: 'audio', mime: 'audio/ogg', description: 'Ogg Vorbis Audio File' },

      // –í–∏–¥–µ–æ
      '66747970': { type: 'MP4/MOV', ext: 'mp4', category: 'video', mime: 'video/mp4', description: 'MP4 Video Container' },
      '1A45DFA3': { type: 'Matroska/MKV', ext: 'mkv', category: 'video', mime: 'video/x-matroska', description: 'Matroska Video Container' },

      // –î–æ–∫—É–º–µ–Ω—Ç—ã
      '25504446': { type: 'PDF', ext: 'pdf', category: 'document', mime: 'application/pdf', description: 'Adobe Portable Document Format' },
      'D0CF11E0A1B11AE1': { type: 'Microsoft Office (—Å—Ç–∞—Ä—ã–π)', ext: 'doc', category: 'document', mime: 'application/msword', description: 'Microsoft Office Document (old format)' },

      // –í–µ–±-—Ñ–∞–π–ª—ã
      '3C21444F43545950': { type: 'HTML', ext: 'html', category: 'web', mime: 'text/html', description: 'HTML Document with DOCTYPE' },
      '3C68746D6C': { type: 'HTML', ext: 'html', category: 'web', mime: 'text/html', description: 'HTML Document' },
      '3C48544D4C': { type: 'HTML', ext: 'html', category: 'web', mime: 'text/html', description: 'HTML Document (uppercase)' },
      '3C3F786D6C': { type: 'XML', ext: 'xml', category: 'web', mime: 'application/xml', description: 'XML Document' },
      '7B0D0A': { type: 'JSON', ext: 'json', category: 'web', mime: 'application/json', description: 'JSON Data File' },

      // –ò—Å–ø–æ–ª–Ω—è–µ–º—ã–µ —Ñ–∞–π–ª—ã
      '4D5A': { type: 'Windows EXE/DLL', ext: 'exe', category: 'executable', mime: 'application/x-msdownload', description: 'Windows Executable or DLL' },
      '7F454C46': { type: 'Linux ELF', ext: 'elf', category: 'executable', mime: 'application/x-executable', description: 'Linux ELF Executable' }
    };

    // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –∏–∑ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
    function getFileExtension(filename) {
      if (!filename) return null;
      const parts = filename.toLowerCase().split('.');
      return parts.length > 1 ? parts[parts.length - 1] : null;
    }

    // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –ø–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é —Ñ–∞–π–ª–∞
    function getTypeByExtension(ext) {
      const extMap = {
        // –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        'jpg': { type: 'JPEG Image', ext: 'jpg', category: 'image', mime: 'image/jpeg', description: 'JPEG Image File' },
        'jpeg': { type: 'JPEG Image', ext: 'jpg', category: 'image', mime: 'image/jpeg', description: 'JPEG Image File' },
        'png': { type: 'PNG Image', ext: 'png', category: 'image', mime: 'image/png', description: 'PNG Image File' },
        'gif': { type: 'GIF Image', ext: 'gif', category: 'image', mime: 'image/gif', description: 'GIF Image File' },
        'bmp': { type: 'BMP Image', ext: 'bmp', category: 'image', mime: 'image/bmp', description: 'Bitmap Image File' },
        'webp': { type: 'WebP Image', ext: 'webp', category: 'image', mime: 'image/webp', description: 'WebP Image File' },

        // –ê—É–¥–∏–æ
        'mp3': { type: 'MP3 Audio', ext: 'mp3', category: 'audio', mime: 'audio/mpeg', description: 'MP3 Audio File' },
        'wav': { type: 'WAV Audio', ext: 'wav', category: 'audio', mime: 'audio/wav', description: 'WAV Audio File' },
        'flac': { type: 'FLAC Audio', ext: 'flac', category: 'audio', mime: 'audio/flac', description: 'FLAC Audio File' },
        'ogg': { type: 'OGG Audio', ext: 'ogg', category: 'audio', mime: 'audio/ogg', description: 'OGG Audio File' },

        // –í–∏–¥–µ–æ
        'mp4': { type: 'MP4 Video', ext: 'mp4', category: 'video', mime: 'video/mp4', description: 'MP4 Video File' },
        'avi': { type: 'AVI Video', ext: 'avi', category: 'video', mime: 'video/x-msvideo', description: 'AVI Video File' },
        'mkv': { type: 'MKV Video', ext: 'mkv', category: 'video', mime: 'video/x-matroska', description: 'Matroska Video File' },
        'mov': { type: 'MOV Video', ext: 'mov', category: 'video', mime: 'video/quicktime', description: 'QuickTime Movie File' },

        // –î–æ–∫—É–º–µ–Ω—Ç—ã
        'pdf': { type: 'PDF Document', ext: 'pdf', category: 'document', mime: 'application/pdf', description: 'PDF Document' },
        'doc': { type: 'Word Document', ext: 'doc', category: 'document', mime: 'application/msword', description: 'Microsoft Word Document' },
        'docx': { type: 'Word Document', ext: 'docx', category: 'document', mime: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document', description: 'Microsoft Word Document (XML)' },

        // –í–µ–±-—Ñ–∞–π–ª—ã
        'html': { type: 'HTML Document', ext: 'html', category: 'web', mime: 'text/html', description: 'HTML Web Page' },
        'htm': { type: 'HTML Document', ext: 'html', category: 'web', mime: 'text/html', description: 'HTML Web Page' },
        'css': { type: 'CSS Stylesheet', ext: 'css', category: 'web', mime: 'text/css', description: 'CSS Stylesheet' },
        'js': { type: 'JavaScript', ext: 'js', category: 'web', mime: 'application/javascript', description: 'JavaScript File' },
        'json': { type: 'JSON Data', ext: 'json', category: 'web', mime: 'application/json', description: 'JSON Data File' },

        // –ê—Ä—Ö–∏–≤—ã
        'zip': { type: 'ZIP Archive', ext: 'zip', category: 'archive', mime: 'application/zip', description: 'ZIP Archive' },
        'rar': { type: 'RAR Archive', ext: 'rar', category: 'archive', mime: 'application/vnd.rar', description: 'RAR Archive' },
        '7z': { type: '7-Zip Archive', ext: '7z', category: 'archive', mime: 'application/x-7z-compressed', description: '7-Zip Archive' }
      };

      return extMap[ext] || null;
    }

    // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞ –ø–æ —Å–∏–≥–Ω–∞—Ç—É—Ä–µ
    function detectFileType(hexData) {
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ —Å–∏–≥–Ω–∞—Ç—É—Ä—ã –æ—Ç —Å–∞–º—ã—Ö –¥–ª–∏–Ω–Ω—ã—Ö –∫ —Å–∞–º—ã–º –∫–æ—Ä–æ—Ç–∫–∏–º
      const signatures = Object.keys(fileSignatures).sort((a, b) => b.length - a.length);
      
      for (const signature of signatures) {
        if (hexData.toUpperCase().startsWith(signature)) {
          return fileSignatures[signature];
        }
      }
      
      return null;
    }

    // –ü–æ–ª—É—á–µ–Ω–∏–µ MIME —Ç–∏–ø–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    function getMimeTypeByCategory(category) {
      const mimeMap = {
        'image': 'image/unknown',
        'audio': 'audio/unknown',
        'video': 'video/unknown',
        'document': 'application/octet-stream',
        'web': 'text/plain',
        'archive': 'application/octet-stream',
        'executable': 'application/octet-stream'
      };
      return mimeMap[category] || 'application/octet-stream';
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ HEX –¥–∞–Ω–Ω—ã—Ö
    function isValidHex(hexData) {
      // –£–¥–∞–ª—è–µ–º –ø—Ä–æ–±–µ–ª—ã –∏ –¥—Ä—É–≥–∏–µ –Ω–µ-HEX —Å–∏–º–≤–æ–ª—ã
      const cleanHex = hexData.replace(/[^0-9A-Fa-f]/g, '');
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–ª–∏–Ω—É (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —á–µ—Ç–Ω–æ–π)
      if (cleanHex.length === 0) return false;
      if (cleanHex.length % 2 !== 0) return false;
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ —Å–∏–º–≤–æ–ª—ã —è–≤–ª—è—é—Ç—Å—è HEX
      return /^[0-9A-Fa-f]+$/.test(cleanHex);
    }

    // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è HEX –≤ ArrayBuffer
    function hexToArrayBuffer(hexString) {
      // –û—á–∏—â–∞–µ–º HEX —Å—Ç—Ä–æ–∫—É
      const cleanHex = hexString.replace(/[^0-9A-Fa-f]/g, '');
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–ª–∏–Ω—É
      if (cleanHex.length % 2 !== 0) {
        throw new Error('Invalid HEX string length');
      }
      
      // –°–æ–∑–¥–∞–µ–º ArrayBuffer
      const buffer = new ArrayBuffer(cleanHex.length / 2);
      const view = new Uint8Array(buffer);
      
      // –ó–∞–ø–æ–ª–Ω—è–µ–º buffer
      for (let i = 0; i < cleanHex.length; i += 2) {
        view[i / 2] = parseInt(cleanHex.substring(i, i + 2), 16);
      }
      
      return buffer;
    }

    // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è ArrayBuffer –≤ HEX
    function arrayBufferToHex(buffer) {
      const view = new Uint8Array(buffer);
      let hex = '';
      
      for (let i = 0; i < view.length; i++) {
        const byte = view[i].toString(16).padStart(2, '0');
        hex += byte;
        // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ–±–µ–ª—ã –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏
        if ((i + 1) % 16 === 0) {
          hex += '\n';
        } else if ((i + 1) % 2 === 0) {
          hex += ' ';
        }
      }
      
      return hex.trim();
    }

    // –û—á–∏—Å—Ç–∫–∞ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
    function clearPreview() {
      // –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π URL –µ—Å–ª–∏ –æ–Ω —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
      if (currentPreviewUrl) {
        URL.revokeObjectURL(currentPreviewUrl);
        currentPreviewUrl = null;
      }
      
      // –û—á–∏—â–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
      previewContent.innerHTML = '';
    }

    // –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
    function showPreview() {
      const hexData = hexArea.value.trim();
      
      if (!hexData) {
        fileInfo.innerHTML = `<span class="invalid">${translations[currentLang]['noData']}</span>`;
        return;
      }
      
      if (!isValidHex(hexData)) {
        fileInfo.innerHTML = `<span class="invalid">${translations[currentLang]['invalidHex']}</span>`;
        return;
      }
      
      try {
        const arrayBuffer = hexToArrayBuffer(hexData);
        const cleanHex = hexData.replace(/[^0-9A-Fa-f]/g, '');
        const detectedType = detectFileType(cleanHex);
        
        // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
        clearPreview();
        
        currentPreviewData = arrayBuffer;
        currentPreviewType = detectedType ? detectedType.category : 'unknown';
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–ª–∏ —Å–∫—Ä—ã–≤–∞–µ–º –∫–æ–Ω—Ç—Ä–æ–ª—ã –¥–ª—è HTML —Ñ–∞–π–ª–æ–≤
        if (detectedType && detectedType.category === 'web') {
          previewControls.style.display = 'flex';
          currentPreviewMode = 'text';
          previewModeText.classList.add('active');
          previewModePage.classList.remove('active');
        } else {
          previewControls.style.display = 'none';
          currentPreviewMode = 'text';
        }
        
        updatePreviewContent();
        previewOverlay.classList.add('active');
        
      } catch (error) {
        fileInfo.innerHTML = `<span class="invalid">Error: ${error.message}</span>`;
      }
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
    function updatePreviewContent() {
      if (!currentPreviewData) return;
      
      // –û—á–∏—â–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
      previewContent.innerHTML = '';
      
      try {
        const cleanHex = hexArea.value.trim().replace(/[^0-9A-Fa-f]/g, '');
        const detectedType = detectFileType(cleanHex);
        
        if (detectedType && detectedType.category === 'web' && currentPreviewMode === 'page') {
          // –†–µ–∂–∏–º —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è HTML - –ø–∞—Ä—Å–∏–º –∫–∞–∫ HTML
          const textDecoder = new TextDecoder('utf-8');
          const textContent = textDecoder.decode(currentPreviewData);
          
          const iframe = document.createElement('iframe');
          iframe.className = 'preview-html-frame';
          iframe.srcdoc = textContent;
          previewContent.appendChild(iframe);
          
        } else if (detectedType && detectedType.category === 'image') {
          // –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
          const mimeType = detectedType.mime || 'image/*';
          const blob = new Blob([currentPreviewData], { type: mimeType });
          currentPreviewUrl = URL.createObjectURL(blob);
          
          const img = document.createElement('img');
          img.className = 'preview-image';
          img.src = currentPreviewUrl;
          previewContent.appendChild(img);
          
        } else if (detectedType && detectedType.category === 'audio') {
          // –ê—É–¥–∏–æ
          const mimeType = detectedType.mime || 'audio/*';
          const blob = new Blob([currentPreviewData], { type: mimeType });
          currentPreviewUrl = URL.createObjectURL(blob);
          
          const audio = document.createElement('audio');
          audio.className = 'preview-audio';
          audio.controls = true;
          audio.src = currentPreviewUrl;
          previewContent.appendChild(audio);
          
        } else if (detectedType && detectedType.category === 'video') {
          // –í–∏–¥–µ–æ
          const mimeType = detectedType.mime || 'video/*';
          const blob = new Blob([currentPreviewData], { type: mimeType });
          currentPreviewUrl = URL.createObjectURL(blob);
          
          const video = document.createElement('video');
          video.className = 'preview-video';
          video.controls = true;
          video.src = currentPreviewUrl;
          previewContent.appendChild(video);
          
        } else {
          // –¢–µ–∫—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º –¥–ª—è –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Ç–∏–ø–æ–≤
          const textDecoder = new TextDecoder('utf-8');
          let textContent;
          
          try {
            textContent = textDecoder.decode(currentPreviewData);
          } catch (e) {
            // –ï—Å–ª–∏ UTF-8 –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø—Ä–æ–±—É–µ–º Latin1
            const latin1Decoder = new TextDecoder('iso-8859-1');
            textContent = latin1Decoder.decode(currentPreviewData);
          }
          
          const pre = document.createElement('pre');
          pre.className = 'preview-text';
          pre.textContent = textContent;
          previewContent.appendChild(pre);
        }
        
      } catch (error) {
        const errorDiv = document.createElement('div');
        errorDiv.className = 'preview-unsupported';
        errorDiv.textContent = translations[currentLang]['previewUnavailable'] || 'Preview not available';
        previewContent.appendChild(errorDiv);
      }
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–∞ —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º–∏
    function checkFile() {
      const hexData = hexArea.value.trim();
      
      if (!hexData) {
        fileInfo.innerHTML = `<span class="invalid">${translations[currentLang]['noData']}</span>`;
        return;
      }
      
      if (!isValidHex(hexData)) {
        fileInfo.innerHTML = `<span class="invalid">${translations[currentLang]['invalidHex']}</span>`;
        return;
      }
      
      fileInfo.innerHTML = `<span class="loading">${translations[currentLang]['loading']}</span>`;
      
      // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏ –¥–ª—è –ª—É—á—à–µ–≥–æ UX
      setTimeout(() => {
        try {
          const cleanHex = hexData.replace(/[^0-9A-Fa-f]/g, '');
          const detectedType = detectFileType(cleanHex);
          const hexLength = cleanHex.length;
          const byteCount = hexLength / 2;
          
          // –ü–æ–ª—É—á–∞–µ–º —Å–∏–≥–Ω–∞—Ç—É—Ä—É (–ø–µ—Ä–≤—ã–µ 8 –±–∞–π—Ç)
          const signature = cleanHex.substring(0, 16).toUpperCase();
          
          // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å —Ñ–∞–π–ª–∞
          const isValid = detectedType !== null;
          
          // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è
          const currentDate = new Date();
          const fileDate = currentDate.toLocaleString();
          
          if (detectedType) {
            const mimeType = detectedType.mime || getMimeTypeByCategory(detectedType.category);
            
            fileInfo.innerHTML = `
              <span class="valid">${translations[currentLang]['fileLoaded']}</span>
              <div class="extension-info">
                <h4>${translations[currentLang]['fileCharacteristics']}</h4>
                <strong>${translations[currentLang]['detectedType']}:</strong> ${detectedType.type}<br>
                <strong>${translations[currentLang]['category']}:</strong> ${detectedType.category}<br>
                <strong>${translations[currentLang]['recommendedExt']}:</strong> .${detectedType.ext}<br>
                <strong>${translations[currentLang]['mimeType']}:</strong> ${mimeType}<br>
                <strong>${translations[currentLang]['hexLength']}:</strong> ${hexLength} ${currentLang === 'ru' ? '—Å–∏–º–≤–æ–ª–æ–≤' : 'characters'}<br>
                <strong>${translations[currentLang]['byteCount']}:</strong> ${byteCount} ${currentLang === 'ru' ? '–±–∞–π—Ç' : 'bytes'}<br>
                <strong>${translations[currentLang]['fileSignature']}:</strong> ${signature}<br>
                <strong>${translations[currentLang]['fileDescription']}:</strong> ${detectedType.description}<br>
                <strong>${translations[currentLang]['fileDate']}:</strong> ${fileDate}<br>
                <strong>${translations[currentLang]['exifData']}:</strong> ${currentLang === 'ru' ? '–ù–µ –¥–æ—Å—Ç—É–ø–Ω–æ –≤ —ç—Ç–æ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ' : 'Not available in this editor'}<br>
                <strong>${translations[currentLang]['validity']}:</strong> <span class="${isValid ? 'valid' : 'invalid'}">${isValid ? translations[currentLang]['valid'] : translations[currentLang]['invalid']}</span>
              </div>
            `;
          } else {
            const mimeType = getMimeTypeByCategory('unknown');
            fileInfo.innerHTML = `
              <span class="valid">${translations[currentLang]['fileLoaded']}</span>
              <div class="extension-info">
                <h4>${translations[currentLang]['fileCharacteristics']}</h4>
                <span class="invalid">${translations[currentLang]['unknownType']}</span><br>
                <strong>${translations[currentLang]['hexLength']}:</strong> ${hexLength} ${currentLang === 'ru' ? '—Å–∏–º–≤–æ–ª–æ–≤' : 'characters'}<br>
                <strong>${translations[currentLang]['byteCount']}:</strong> ${byteCount} ${currentLang === 'ru' ? '–±–∞–π—Ç' : 'bytes'}<br>
                <strong>${translations[currentLang]['fileSignature']}:</strong> ${signature}<br>
                <strong>${translations[currentLang]['mimeType']}:</strong> ${mimeType}<br>
                <strong>${translations[currentLang]['fileDate']}:</strong> ${fileDate}<br>
                <strong>${translations[currentLang]['exifData']}:</strong> ${currentLang === 'ru' ? '–ù–µ –¥–æ—Å—Ç—É–ø–Ω–æ –≤ —ç—Ç–æ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ' : 'Not available in this editor'}<br>
                <strong>${translations[currentLang]['validity']}:</strong> <span class="${isValid ? 'valid' : 'invalid'}">${isValid ? translations[currentLang]['valid'] : translations[currentLang]['invalid']}</span>
              </div>
            `;
          }
        } catch (error) {
          fileInfo.innerHTML = `<span class="invalid">Error: ${error.message}</span>`;
        }
      }, 500);
    }

    // –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
    function downloadFile() {
      const hexData = hexArea.value.trim();
      
      if (!hexData) {
        fileInfo.innerHTML = `<span class="invalid">${translations[currentLang]['noData']}</span>`;
        return;
      }
      
      if (!isValidHex(hexData)) {
        fileInfo.innerHTML = `<span class="invalid">${translations[currentLang]['invalidHex']}</span>`;
        return;
      }
      
      try {
        const arrayBuffer = hexToArrayBuffer(hexData);
        const cleanHex = hexData.replace(/[^0-9A-Fa-f]/g, '');
        const detectedType = detectFileType(cleanHex);
        
        const extension = detectedType ? detectedType.ext : 'bin';
        const mimeType = detectedType ? (detectedType.mime || getMimeTypeByCategory(detectedType.category)) : 'application/octet-stream';
        const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);
        const filename = `hex-file-${timestamp}.${extension}`;
        
        const blob = new Blob([arrayBuffer], { type: mimeType });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        fileInfo.innerHTML = `<span class="valid">${translations[currentLang]['downloadSuccess']} ${filename}</span>`;
        
      } catch (error) {
        fileInfo.innerHTML = `<span class="invalid">Error: ${error.message}</span>`;
      }
    }

    // –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª—è
    function clearField() {
      hexArea.value = '';
      fileInfo.innerHTML = `<span>${translations[currentLang]['selectFile']}</span>`;
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∫–Ω–æ–ø–∫–∏ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
    function updateFullscreenButtonText() {
      if (document.fullscreenElement) {
        fullscreenBtn.textContent = translations[currentLang]['normalScreen'] || 'Normal Mode';
      } else {
        fullscreenBtn.textContent = translations[currentLang]['fullscreen'] || 'Fullscreen Mode';
      }
    }

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
    function toggleFullscreen() {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen().catch(err => {
          console.error(`Error attempting to enable fullscreen: ${err.message}`);
        });
      } else {
        if (document.exitFullscreen) {
          document.exitFullscreen();
        }
      }
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
    fileInput.addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (!file) return;
      
      fileInfo.innerHTML = `<span class="loading">${translations[currentLang]['loading']}</span>`;
      
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const arrayBuffer = e.target.result;
          const hex = arrayBufferToHex(arrayBuffer);
          hexArea.value = hex;
          
          // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –ø–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é, –µ—Å–ª–∏ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–∏–ª–∏ –ø–æ —Å–∏–≥–Ω–∞—Ç—É—Ä–µ
          const fileExt = getFileExtension(file.name);
          const extType = getTypeByExtension(fileExt);
          const hexData = hex.replace(/[^0-9A-Fa-f]/g, '');
          const detectedType = detectFileType(hexData) || extType;
          const hexLength = hexData.length;
          const byteCount = hexLength / 2;
          const signature = hexData.substring(0, 16).toUpperCase();
          
          // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å —Ñ–∞–π–ª–∞
          const isValid = detectedType !== null;
          
          // –ü–æ–ª—É—á–∞–µ–º –¥–∞—Ç—É —Ñ–∞–π–ª–∞
          const fileDate = new Date(file.lastModified).toLocaleString();
          
          if (detectedType) {
            const mimeType = detectedType.mime || getMimeTypeByCategory(detectedType.category);
            
            fileInfo.innerHTML = `
              <span class="valid">${translations[currentLang]['fileLoaded']}</span>
              <div class="extension-info">
                <h4>${translations[currentLang]['fileCharacteristics']}</h4>
                <strong>${translations[currentLang]['originalName']}:</strong> ${file.name}<br>
                <strong>${translations[currentLang]['detectedType']}:</strong> ${detectedType.type}<br>
                <strong>${translations[currentLang]['category']}:</strong> ${detectedType.category}<br>
                <strong>${translations[currentLang]['recommendedExt']}:</strong> .${detectedType.ext}<br>
                <strong>${translations[currentLang]['mimeType']}:</strong> ${mimeType}<br>
                <strong>${translations[currentLang]['size']}:</strong> ${file.size} ${currentLang === 'ru' ? '–±–∞–π—Ç' : 'bytes'}<br>
                <strong>${translations[currentLang]['hexLength']}:</strong> ${hexLength} ${currentLang === 'ru' ? '—Å–∏–º–≤–æ–ª–æ–≤' : 'characters'}<br>
                <strong>${translations[currentLang]['fileSignature']}:</strong> ${signature}<br>
                <strong>${translations[currentLang]['fileDescription']}:</strong> ${detectedType.description}<br>
                <strong>${translations[currentLang]['fileDate']}:</strong> ${fileDate}<br>
                <strong>${translations[currentLang]['exifData']}:</strong> ${currentLang === 'ru' ? '–ù–µ –¥–æ—Å—Ç—É–ø–Ω–æ –≤ —ç—Ç–æ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ' : 'Not available in this editor'}<br>
                <strong>${translations[currentLang]['validity']}:</strong> <span class="${isValid ? 'valid' : 'invalid'}">${isValid ? translations[currentLang]['valid'] : translations[currentLang]['invalid']}</span>
              </div>
            `;
          } else {
            const mimeType = getMimeTypeByCategory('unknown');
            fileInfo.innerHTML = `
              <span class="valid">${translations[currentLang]['fileLoaded']}</span>
              <div class="extension-info">
                <h4>${translations[currentLang]['fileCharacteristics']}</h4>
                <strong>${translations[currentLang]['originalName']}:</strong> ${file.name}<br>
                <strong>${translations[currentLang]['size']}:</strong> ${file.size} ${currentLang === 'ru' ? '–±–∞–π—Ç' : 'bytes'}<br>
                <strong>${translations[currentLang]['hexLength']}:</strong> ${hexLength} ${currentLang === 'ru' ? '—Å–∏–º–≤–æ–ª–æ–≤' : 'characters'}<br>
                <strong>${translations[currentLang]['fileSignature']}:</strong> ${signature}<br>
                <strong>${translations[currentLang]['mimeType']}:</strong> ${mimeType}<br>
                <strong>${translations[currentLang]['fileDate']}:</strong> ${fileDate}<br>
                <strong>${translations[currentLang]['exifData']}:</strong> ${currentLang === 'ru' ? '–ù–µ –¥–æ—Å—Ç—É–ø–Ω–æ –≤ —ç—Ç–æ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ' : 'Not available in this editor'}<br>
                <span class="invalid">${translations[currentLang]['unknownType']}</span><br>
                <strong>${translations[currentLang]['validity']}:</strong> <span class="${isValid ? 'valid' : 'invalid'}">${isValid ? translations[currentLang]['valid'] : translations[currentLang]['invalid']}</span>
              </div>
            `;
          }
        } catch (error) {
          fileInfo.innerHTML = `<span class="invalid">Error loading file: ${error.message}</span>`;
        }
      };
      
      reader.onerror = function() {
        fileInfo.innerHTML = `<span class="invalid">${translations[currentLang]['loadError']}</span>`;
      };
      
      reader.readAsArrayBuffer(file);
    });

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
    document.getElementById('checkBtn').addEventListener('click', checkFile);
    document.getElementById('previewBtn').addEventListener('click', showPreview);
    document.getElementById('downloadBtn').addEventListener('click', downloadFile);
    document.getElementById('clearBtn').addEventListener('click', clearField);
    
    // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
    previewClose.addEventListener('click', () => {
      previewOverlay.classList.remove('active');
      clearPreview(); // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
    });
    
    // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –æ–∫–Ω–∞
    previewOverlay.addEventListener('click', (e) => {
      if (e.target === previewOverlay) {
        previewOverlay.classList.remove('active');
        clearPreview(); // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
      }
    });
    
    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
    previewModeText.addEventListener('click', () => {
      if (currentPreviewMode !== 'text') {
        currentPreviewMode = 'text';
        previewModeText.classList.add('active');
        previewModePage.classList.remove('active');
        updatePreviewContent();
      }
    });
    
    previewModePage.addEventListener('click', () => {
      if (currentPreviewMode !== 'page') {
        currentPreviewMode = 'page';
        previewModePage.classList.add('active');
        previewModeText.classList.remove('active');
        updatePreviewContent();
      }
    });
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
    fullscreenBtn.addEventListener('click', toggleFullscreen);
    
    // –°–ª—É—à–∞—Ç–µ–ª—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
    document.addEventListener('fullscreenchange', () => {
      if (document.fullscreenElement) {
        document.body.classList.add('fullscreen');
      } else {
        document.body.classList.remove('fullscreen');
      }
      updateFullscreenButtonText();
    });

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –∫–Ω–æ–ø–∫—É –∑–∞–≥—Ä—É–∑–∫–∏ (—Ç–æ–ª—å–∫–æ –≤ –≥—Ä–∞–Ω–∏—Ü–∞—Ö)
    document.querySelector('.file-input-container').addEventListener('click', function(e) {
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–ª–∏–∫ –±—ã–ª –∏–º–µ–Ω–Ω–æ –ø–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É (–∞ –Ω–µ –ø–æ –¥–æ—á–µ—Ä–Ω–∏–º —ç–ª–µ–º–µ–Ω—Ç–∞–º)
      if (e.target === this) {
        fileInput.click();
      }
    });
  </script>
</body>
</html>