<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="HEX –†–µ–¥–∞–∫—Ç–æ—Ä –æ—Ç Asirus - –†–µ–¥–∞–∫—Ç–æ—Ä, –≥–¥–µ –º–æ–∂–Ω–æ –Ω–∞–ø—Ä—è–º—É—é –∏–∑–º–µ–Ω–∏—Ç—å –±–∞–π—Ç—ã —Ñ–∞–π–ª–∞!" />
  <meta name="keywords" content="HEX —Ä–µ–¥–∞–∫—Ç–æ—Ä, –æ–Ω–ª–∞–π–Ω hex —Ä–µ–¥–∞–∫—Ç–æ—Ä, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –±–∞–π—Ç—ã, —à–µ—Å—Ç–Ω–∞–¥—Ü–∞—Ç–µ—Ä–∏—á–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä, hex tool, hex editor">
  <link rel="icon" href="/res/img/favicon.png" />
  <title>HEX –†–µ–¥–∞–∫—Ç–æ—Ä</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    html, body {
      width: 100%;
      min-height: 100vh; 
      overflow-x: hidden;
      font-size: 16px; 
    }

    body {
      display: block;
      background: #f0f0f0;
      padding: 0px; 
    }

    header {
      background: #4a76a8;
      color: #fff;
      width: 100%;
      height: 60px; 
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      font-size: 1.5rem; 
      font-weight: 600;
      border-bottom: 2px solid #3a5a80;
      flex-shrink: 0;
      margin-bottom: 10px; 
    }

    main {
      width: 100%;
      max-width: 900px;
      margin: 0 auto; 
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 15px; 
      gap: 12px; 
      padding-bottom: 120px;
    }

    input[type="file"] {
      display: none;
    }

    #fileInputlabel {
      margin: 10px 0; 
      padding: 10px; 
      background: white; 
      border: 1px dashed #4a76a8; 
      width: 60%;
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 1rem;
      text-align: center;
    }
    
    textarea {
      width: 100%;
      height: 300px; 
      resize: none;
      font-family: 'Fira Code', 'Consolas', monospace;
      font-size: 14px; 
      margin: 10px 0; 
      padding: 12px; 
      border: 1px solid #ccc; 
      border-radius: 4px; 
      background: #fafafa;
      box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1); 
      line-height: 1.4; 
    }

    textarea:focus {
      outline: none;
      border-color: #4a76a8;
      box-shadow: inset 0 1px 2px rgba(74, 118, 168, 0.1);
    }

    .info {
      margin: 10px 0; 
      padding: 12px; 
      background: white;
      border-radius: 4px; 
      width: 100%;
      text-align: center;
      font-size: 1rem; 
      border: 1px solid #ddd; 
      border-left: 4px solid #4a76a8; 
      line-height: 1.5; 
    }

    .valid {
      color: #4caf50;
      font-weight: bold;
      font-size: 0.9rem; 
    }

    .invalid {
      color: #f44336;
      font-weight: bold;
      font-size: 0.9rem;
    }

    .loading {
      color: #ff9800;
      font-weight: bold;
      font-size: 0.9rem;
    }

    .extension-info {
      background: #e3f2fd;
      border-left: 2px solid #2196f3;
      padding: 8px 10px;
      margin: 8px 0;
      font-size: 0.9rem;
      border-radius: 3px;
      line-height: 1.4;
    }

    .buttons-container {
      width: 100%;
      max-width: 900px;
      padding: 0 15px 15px; 
      position: fixed;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(transparent 0%, #f0f0f0 15%);
      z-index: 100;
    }

    .buttons {
      display: flex;
      gap: 8px; 
      flex-wrap: wrap;
      justify-content: center;
      width: 100%;
      background: white;
      padding: 10px; 
      border: 1px solid #ddd;
    }
    
    .buts {
      padding: 8px 15px; 
      background: #4a76a8;
      color: white;
      border: 1px solid #3a5a80;
      border-radius: 4px; 
      cursor: pointer;
      font-weight: 500;
      font-size: 0.9rem; 
      transition: all 0.15s ease; 
      white-space: nowrap;
      flex: 1;
      min-width: 70px; 
      max-width: 120px; 
      display: flex;
      justify-content: center;
      align-items: center;
      height: 36px; 
    }

    button:hover {
      background: #3a5a80;
    }

    button:active {
      background: #2a4a70;
    }

    button:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }

    @media (max-width: 768px) {
      html, body {
        font-size: 15px;
      }
      
      .buttons {
        padding: 8px;
        gap: 6px;
      }
      
      button {
        flex: 1 0 calc(50% - 6px);
        min-width: 60px;
        max-width: calc(50% - 6px);
        padding: 6px 10px;
        font-size: 0.85rem;
        height: 32px;
      }
      
      .buttons-container {
        padding: 0 12px 12px;
      }
      
      textarea {
        height: 250px;
        font-size: 13px;
      }
      
      header {
        font-size: 1.3rem;
        height: 55px;
      }
      
      main {
        padding: 12px;
        gap: 10px;
      }
    }

    @media (max-width: 400px) {
      html, body {
        font-size: 14px;
      }
      
      button {
        flex: 1 0 calc(50% - 5px);
        min-width: 55px;
        max-width: calc(50% - 5px);
        padding: 5px 8px;
        font-size: 0.8rem;
        height: 30px;
      }
      
      .buttons {
        gap: 5px;
        padding: 8px;
      }
      
      textarea {
        height: 220px;
        font-size: 12px;
      }
      
      header {
        font-size: 1.2rem;
        height: 50px;
      }
    }

    @media (min-width: 769px) {
      .buttons {
        flex-wrap: nowrap;
      }
      
      button {
        flex: 1;
        min-width: 70px;
        max-width: 140px;
        height: 36px;
      }
    }

    .preview-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.2s ease;
    }

    .preview-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .preview-container {
      background: white;
      border-radius: 4px;
      width: 90%;
      max-width: 650px;
      max-height: 70%;
      overflow: hidden;
      border: 1px solid #ccc;
      display: flex;
      flex-direction: column;
    }

    .preview-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 16px;
      background: #4a76a8;
      color: white;
      border-bottom: 1px solid #3a5a80;
    }

    .preview-title {
      font-weight: 600;
      font-size: 1.1rem;
    }

    .preview-close {
      background: none;
      border: none;
      color: white;
      font-size: 1.3rem;
      cursor: pointer;
      width: 28px;
      height: 28px;
      display: flex;
      justify-content: center;
      align-items: center;
      border-radius: 50%;
      transition: background 0.15s ease;
    }

    .preview-close:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .preview-content {
      padding: 15px;
      overflow: auto;
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .preview-text {
      white-space: pre-wrap;
      font-family: monospace;
      background: #f8f9fa;
      padding: 12px;
      border-radius: 4px;
      max-height: 300px;
      overflow: auto;
      width: 100%;
      font-size: 0.9rem;
      line-height: 1.4;
      border: 1px solid #ddd;
    }

    .preview-image {
      max-width: 100%;
      max-height: 300px;
      border-radius: 4px;
    }

    .preview-video {
      max-width: 100%;
      max-height: 300px;
      border-radius: 4px;
    }

    .preview-audio {
      width: 100%;
      margin: 15px 0;
    }

    .preview-unsupported {
      padding: 20px;
      text-align: center;
      color: #6c757d;
      font-size: 0.95rem;
    }

    @supports (padding: max(0px)) {
      .buttons-container {
        padding-bottom: max(15px, env(safe-area-inset-bottom));
      }
    }

    main {
      scroll-behavior: smooth;
    }
    
    details ol {
      padding: 20px;
    }
    
    .lang-container {
      position: fixed;
      bottom: 10px;
      right: 10px;
      display: flex;
      gap: 5px;
      z-index: 101;
    }
    
    .lang {
      width: 30px;
      height: 30px;
      overflow: hidden;
      font-size: 24px;
      display: flex;
      justify-content: center;
      align-items: center;
      background: white;
      border: 1px solid #ccc;
      border-radius: 4px;
      cursor: pointer;
    }
    
    .lang:hover {
      background: #f0f0f0;
    }
    
    .lang.active {
      border: 2px solid #4a76a8;
    }
    
    hr {
      width: 90%;
      border: 0;
      border-top: 1px solid #ddd;
      margin: 15px 0;
    }
    
    details {
      width: 100%;
      margin: 10px 0;
      border: 1px solid #ddd;
      border-radius: 4px;
      background: white;
    }
    
    details summary {
      padding: 12px 15px;
      cursor: pointer;
      font-weight: 600;
      background: #f5f5f5;
      border-bottom: 1px solid #ddd;
    }
    
    details[open] summary {
      border-bottom: 1px solid #ddd;
    }
    
    details ol, details ul {
      padding: 15px 30px;
    }
    
    details li {
      margin: 8px 0;
    }
  </style>
</head>
<body>
  <header data-i18n="title">HEX Editor</header>
  <main>
    <label id="fileInputlabel" for="fileInput" data-i18n="loadFile">
      <input type="file" id="fileInput">
      Load File
    </label>
    <textarea id="hexArea" placeholder="HEX data..." data-i18n-placeholder="hexPlaceholder"></textarea>
    <div class="info" id="fileInfo" data-i18n="selectFile">Select a file or enter HEX data</div>
    <div class="buttons">
      <button class="buts" id="checkBtn" data-i18n="check">Check</button>
      <button class="buts" id="previewBtn" data-i18n="preview">Preview</button>
      <button class="buts" id="downloadBtn" data-i18n="download">Download</button>
      <button class="buts" id="clearBtn" data-i18n="clear">Clear</button>
    </div>
    <hr>
    <details>
      <summary><h3 data-i18n="instructionTitle">HEX Editor Instructions</h3></summary>
      <ol>
        <li data-i18n="instruction1">Click "Load file" at the top to upload a file.</li>
        <br>
        <li data-i18n="instruction2">You will see a field with hexadecimal data.</li>
        <br>
        <li data-i18n="instruction3">You can modify bytes in the field, but do not touch the first bytes - without them the file will be marked as invalid.</li>
        <br>
        <li data-i18n="instruction4">Click "Check" to determine the file type.</li>
        <br>
        <li data-i18n="instruction5">Click "Preview" to preview the file if it's a photo/audio/video.</li>
        <br>
        <li data-i18n="instruction6">Click "Download" to download the modified file.</li>
        <br>
        <li data-i18n="instruction7">Click "Clear" to clear the field of bytes.</li>
      </ol>
    </details>
    <details>
      <summary><h3 data-i18n="purposeTitle">What is a "HEX Editor" for?</h3></summary>
      <ul>
        <li data-i18n="purpose1">"HEX Editor" is primarily needed for low-level file editing at the byte level.</li>
        <br>
        <li data-i18n="purpose2">In the "HEX Editor" you can get acquainted with bytes for the first time.</li>
        <br>
        <li data-i18n="purpose3">This "HEX Editor" has been simplified for better performance. If you need a powerful editor, it is recommended to visit <a href="https://www.sweetscape.com/010editor/?hl=ru-RU">010 editor</a> or <a href="https://hexed.it/">Hexed IT</a>.</li>
      </ul>
    </details>
  </main>
  
  <!-- Language selector -->
  <div class="lang-container">
    <button class="lang" id="langRu">üá∑üá∫</button>
    <button class="lang active" id="langEn">üá¨üáß</button>
  </div>
  
  <!-- Preview window -->
  <div class="preview-overlay" id="previewOverlay">
    <div class="preview-container">
      <div class="preview-header">
        <div class="preview-title" data-i18n="previewTitle">File Preview</div>
        <button class="preview-close" id="previewClose">√ó</button>
      </div>
      <div class="preview-content" id="previewContent">
        <div class="preview-unsupported" data-i18n="previewUnavailable">Preview not available</div>
      </div>
    </div>
  </div>

  <script>
    // Language support
    const translations = {
      'ru': {
        'title': 'HEX –†–µ–¥–∞–∫—Ç–æ—Ä',
        'loadFile': '–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª',
        'hexPlaceholder': 'HEX –¥–∞–Ω–Ω—ã–µ...',
        'selectFile': '–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ HEX –¥–∞–Ω–Ω—ã–µ',
        'check': '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å',
        'preview': '–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä',
        'download': '–°–∫–∞—á–∞—Ç—å',
        'clear': '–û—á–∏—Å—Ç–∏—Ç—å',
        'instructionTitle': '–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ä–∞–±–æ—Ç–µ —Å HEX –†–µ–¥–∞–∫—Ç–æ—Ä–æ–º',
        'instruction1': '–ù–∞–∂–º–∏—Ç–µ ¬´–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª¬ª —Å–≤–µ—Ä—Ö—É, —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª.',
        'instruction2': '–ü–µ—Ä–µ–¥ –≤–∞–º–∏ –ø–æ–ª–µ —Å —à–µ—Å—Ç–Ω–∞–¥—Ü–∞—Ç–µ—Ä–∏—á–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º.',
        'instruction3': '–í—ã –º–æ–∂–µ—Ç–µ –∏–∑–º–µ–Ω—è—Ç—å –±–∞–π—Ç—ã –≤ –ø–æ–ª–µ, –Ω–æ –Ω–µ —Ç—Ä–æ–≥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–µ –±–∞–π—Ç—ã - –±–µ–∑ –Ω–∏—Ö —Ñ–∞–π–ª –±—É–¥–µ—Ç –ø–æ–º–µ—á–µ–Ω –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º.',
        'instruction4': '–ù–∞–∂–º–∏—Ç–µ ¬´–ü—Ä–æ–≤–µ—Ä–∏—Ç—å¬ª —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å —Ç–∏–ø —Ñ–∞–π–ª–∞.',
        'instruction5': '–ù–∞–∂–º–∏—Ç–µ ¬´–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä¬ª —á—Ç–æ–±—ã –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ñ–∞–π–ª, –µ—Å–ª–∏ –æ–Ω —Ñ–æ—Ç–æ/–∞—É–¥–∏–æ/–≤–∏–¥–µ–æ.',
        'instruction6': '–ù–∞–∂–º–∏—Ç–µ ¬´–°–∫–∞—á–∞—Ç—å¬ª —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–π —Ñ–∞–π–ª.',
        'instruction7': '–ù–∞–∂–º–∏—Ç–µ ¬´–û—á–∏—Å—Ç–∏—Ç—å¬ª —á—Ç–æ–±—ã –æ—á–∏—Å—Ç–∏—Ç—å –ø–æ–ª–µ –æ—Ç –±–∞–π—Ç–æ–≤.',
        'purposeTitle': '–ó–∞—á–µ–º –Ω—É–∂–µ–Ω ¬´HEX —Ä–µ–¥–∞–∫—Ç–æ—Ä¬ª?',
        'purpose1': '¬´HEX —Ä–µ–¥–∞–∫—Ç–æ—Ä¬ª –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å –Ω—É–∂–µ–Ω –¥–ª—è –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –Ω–∞ —É—Ä–æ–≤–Ω–µ –±–∞–π—Ç–æ–≤.',
        'purpose2': '–í ¬´HEX —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ¬ª –º–æ–∂–Ω–æ –≤–ø–µ—Ä–≤—ã–µ –æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å –±–∞–π—Ç–∞–º–∏',
        'purpose3': '–î–∞–Ω–Ω—ã–π ¬´HEX —Ä–µ–¥–∞–∫—Ç–æ—Ä¬ª –±—ã–ª —É–ø—Ä–æ—â—ë–Ω –¥–ª—è –ª—É—á—à–µ–π —Ä–∞–±–æ—Ç—ã. –ï—Å–ª–∏ –≤–∞–º –Ω—É–∂–µ–Ω –º–æ—â–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä, —Å–æ–≤–µ—Ç—É–µ—Ç—Å—è –∑–∞–π—Ç–∏ –Ω–∞ <a href="https://www.sweetscape.com/010editor/?hl=ru-RU">010 editor</a> –∏–ª–∏ <a href="https://hexed.it/">Hexed IT</a>.',
        'previewTitle': '–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ñ–∞–π–ª–∞',
        'previewUnavailable': '–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω'
      },
      'en': {
        'title': 'HEX Editor',
        'loadFile': 'Load File',
        'hexPlaceholder': 'HEX data...',
        'selectFile': 'Select a file or enter HEX data',
        'check': 'Check',
        'preview': 'Preview',
        'download': 'Download',
        'clear': 'Clear',
        'instructionTitle': 'HEX Editor Instructions',
        'instruction1': 'Click "Load file" at the top to upload a file.',
        'instruction2': 'You will see a field with hexadecimal data.',
        'instruction3': 'You can modify bytes in the field, but do not touch the first bytes - without them the file will be marked as invalid.',
        'instruction4': 'Click "Check" to determine the file type.',
        'instruction5': 'Click "Preview" to preview the file if it\'s a photo/audio/video.',
        'instruction6': 'Click "Download" to download the modified file.',
        'instruction7': 'Click "Clear" to clear the field of bytes.',
        'purposeTitle': 'What is a "HEX Editor" for?',
        'purpose1': '"HEX Editor" is primarily needed for low-level file editing at the byte level.',
        'purpose2': 'In the "HEX Editor" you can get acquainted with bytes for the first time.',
        'purpose3': 'This "HEX Editor" has been simplified for better performance. If you need a powerful editor, it is recommended to visit <a href="https://www.sweetscape.com/010editor/?hl=ru-RU">010 editor</a> or <a href="https://hexed.it/">Hexed IT</a>.',
        'previewTitle': 'File Preview',
        'previewUnavailable': 'Preview not available'
      }
    };

    // Language management
    let currentLang = 'en';

    function setLanguage(lang) {
      currentLang = lang;
      localStorage.setItem('hexEditorLang', lang);
      
      // Update active button
      document.getElementById('langRu').classList.toggle('active', lang === 'ru');
      document.getElementById('langEn').classList.toggle('active', lang === 'en');
      
      // Update all translatable elements
      document.querySelectorAll('[data-i18n]').forEach(element => {
        const key = element.getAttribute('data-i18n');
        if (translations[lang][key]) {
          element.innerHTML = translations[lang][key];
        }
      });
      
      // Update placeholders
      document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
        const key = element.getAttribute('data-i18n-placeholder');
        if (translations[lang][key]) {
          element.placeholder = translations[lang][key];
        }
      });
    }

    // Initialize language
    document.addEventListener('DOMContentLoaded', () => {
      const savedLang = localStorage.getItem('hexEditorLang') || 'en';
      setLanguage(savedLang);
      
      // Language button event listeners
      document.getElementById('langRu').addEventListener('click', () => setLanguage('ru'));
      document.getElementById('langEn').addEventListener('click', () => setLanguage('en'));
    });

    // Rest of the existing JavaScript code remains the same
    const fileInput = document.getElementById('fileInput');
    const hexArea = document.getElementById('hexArea');
    const fileInfo = document.getElementById('fileInfo');
    const previewBtn = document.getElementById('previewBtn');
    const previewOverlay = document.getElementById('previewOverlay');
    const previewClose = document.getElementById('previewClose');
    const previewContent = document.getElementById('previewContent');

    // –ë–∞–∑–∞ —Å–∏–≥–Ω–∞—Ç—É—Ä —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è–º–∏ –∏ –æ–ø–∏—Å–∞–Ω–∏—è–º–∏
    const fileSignatures = {
      // –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
      'FFD8FFE0': { type: 'JPEG (JFIF)', ext: 'jpg', category: 'image' },
      'FFD8FFE1': { type: 'JPEG (EXIF)', ext: 'jpg', category: 'image' },
      'FFD8FFDB': { type: 'JPEG', ext: 'jpg', category: 'image' },
      'FFD8FFEE': { type: 'JPEG', ext: 'jpg', category: 'image' },
      'FFD8FF': { type: 'JPEG', ext: 'jpg', category: 'image' },
      '89504E470D0A1A0A': { type: 'PNG', ext: 'png', category: 'image' },
      '474946383761': { type: 'GIF87a', ext: 'gif', category: 'image' },
      '474946383961': { type: 'GIF89a', ext: 'gif', category: 'image' },
      '424D': { type: 'BMP', ext: 'bmp', category: 'image' },
      '49492A00': { type: 'TIFF (Little Endian)', ext: 'tiff', category: 'image' },
      '4D4D002A': { type: 'TIFF (Big Endian)', ext: 'tiff', category: 'image' },
      '00000100': { type: 'ICO', ext: 'ico', category: 'image' },
      '52494646': { type: 'WebP/WAV/AVI', ext: 'webp', category: 'image', needsCheck: true },
      '38425053': { type: 'PSD', ext: 'psd', category: 'image' },
      '57454250': { type: 'WebP', ext: 'webp', category: 'image' },

      // –ê—Ä—Ö–∏–≤—ã
      '504B0304': { type: 'ZIP/JAR/DOCX/XLSX', ext: 'zip', category: 'archive' },
      '504B0506': { type: 'ZIP (–ø—É—Å—Ç–æ–π)', ext: 'zip', category: 'archive' },
      '504B0708': { type: 'ZIP', ext: 'zip', category: 'archive' },
      '526172211A0700': { type: 'RAR v1.5+', ext: 'rar', category: 'archive' },
      '526172211A070100': { type: 'RAR v5.0+', ext: 'rar', category: 'archive' },
      '377ABCAF271C': { type: '7-Zip', ext: '7z', category: 'archive' },
      '425A68': { type: 'BZIP2', ext: 'bz2', category: 'archive' },
      '1F8B08': { type: 'GZIP', ext: 'gz', category: 'archive' },

      // –ê—É–¥–∏–æ
      '494433': { type: 'MP3 (ID3v2)', ext: 'mp3', category: 'audio' },
      'FFFB': { type: 'MP3', ext: 'mp3', category: 'audio' },
      'FFF3': { type: 'MP3', ext: 'mp3', category: 'audio' },
      'FFF2': { type: 'MP3', ext: 'mp3', category: 'audio' },
      '464C4143': { type: 'FLAC', ext: 'flac', category: 'audio' },
      '4F676753': { type: 'OGG', ext: 'ogg', category: 'audio' },
      '4D546864': { type: 'MIDI', ext: 'mid', category: 'audio' },
      '52494646': { type: 'WAV', ext: 'wav', category: 'audio', needsCheck: true },

      // –í–∏–¥–µ–æ
      '000001BA': { type: 'MPEG Video', ext: 'mpg', category: 'video' },
      '000001B3': { type: 'MPEG Video', ext: 'mpg', category: 'video' },
      '66747970': { type: 'MP4/MOV', ext: 'mp4', category: 'video' },
      '1A45DFA3': { type: 'Matroska/MKV', ext: 'mkv', category: 'video' },
      '464C56': { type: 'Flash Video', ext: 'flv', category: 'video' },
      '30262E31': { type: 'WMV', ext: 'wmv', category: 'video' },
      '52494646': { type: 'AVI', ext: 'avi', category: 'video', needsCheck: true },

      // –î–æ–∫—É–º–µ–Ω—Ç—ã
      '25504446': { type: 'PDF', ext: 'pdf', category: 'document' },
      'D0CF11E0A1B11AE1': { type: 'Microsoft Office (—Å—Ç–∞—Ä—ã–π)', ext: 'doc', category: 'document' },
      '7B5C727466': { type: 'RTF', ext: 'rtf', category: 'document' },
      '504B0304': { type: 'DOCX', ext: 'docx', category: 'document', needsCheck: true },
      '504B0304': { type: 'XLSX', ext: 'xlsx', category: 'document', needsCheck: true },
      '504B0304': { type: 'PPTX', ext: 'pptx', category: 'document', needsCheck: true },

      // –í–µ–±-—Ñ–∞–π–ª—ã
      '3C21444F43545950': { type: 'HTML', ext: 'html', category: 'web' },
      '3C68746D6C': { type: 'HTML', ext: 'html', category: 'web' },
      '3C48544D4C': { type: 'HTML', ext: 'html', category: 'web' },
      '2F2A': { type: 'CSS/JS', ext: 'css', category: 'web', needsCheck: true },
      '3C3F786D6C': { type: 'XML', ext: 'xml', category: 'web' },
      '7B0D0A': { type: 'JSON', ext: 'json', category: 'web' },
      '7B': { type: 'JSON', ext: 'json', category: 'web' },
      'EFBBBF': { type: 'UTF-8 BOM', ext: 'txt', category: 'text' },

      // –ò—Å–ø–æ–ª–Ω—è–µ–º—ã–µ —Ñ–∞–π–ª—ã
      '4D5A': { type: 'Windows EXE/DLL', ext: 'exe', category: 'executable' },
      '7F454C46': { type: 'Linux ELF', ext: 'elf', category: 'executable' },
      'FEEDFACE': { type: 'Mach-O 32-bit', ext: 'macho', category: 'executable' },
      'FEEDFACF': { type: 'Mach-O 64-bit', ext: 'macho', category: 'executable' },
      'CAFEBABE': { type: 'Java Class', ext: 'class', category: 'executable' },

      // –¢–µ–∫—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã —Å BOM
      'FEFF': { type: 'UTF-16 BE BOM', ext: 'txt', category: 'text' },
      'FFFE': { type: 'UTF-16 LE BOM', ext: 'txt', category: 'text' }
    };

    // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –∏–∑ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
    function getFileExtension(filename) {
      if (!filename) return null;
      const parts = filename.toLowerCase().split('.');
      return parts.length > 1 ? parts[parts.length - 1] : null;
    }

    // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –ø–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é —Ñ–∞–π–ª–∞
    function getTypeByExtension(ext) {
      const extMap = {
        // –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        'jpg': { type: 'JPEG Image', ext: 'jpg', category: 'image' },
        'jpeg': { type: 'JPEG Image', ext: 'jpg', category: 'image' },
        'png': { type: 'PNG Image', ext: 'png', category: 'image' },
        'gif': { type: 'GIF Image', ext: 'gif', category: 'image' },
        'bmp': { type: 'BMP Image', ext: 'bmp', category: 'image' },
        'webp': { type: 'WebP Image', ext: 'webp', category: 'image' },
        'tiff': { type: 'TIFF Image', ext: 'tiff', category: 'image' },
        'ico': { type: 'Icon', ext: 'ico', category: 'image' },
        'psd': { type: 'Photoshop', ext: 'psd', category: 'image' },
        'svg': { type: 'SVG Image', ext: 'svg', category: 'image' },
        
        // –ê—É–¥–∏–æ
        'mp3': { type: 'MP3 Audio', ext: 'mp3', category: 'audio' },
        'wav': { type: 'WAV Audio', ext: 'wav', category: 'audio' },
        'flac': { type: 'FLAC Audio', ext: 'flac', category: 'audio' },
        'ogg': { type: 'OGG Audio', ext: 'ogg', category: 'audio' },
        'aac': { type: 'AAC Audio', ext: 'aac', category: 'audio' },
        'wma': { type: 'WMA Audio', ext: 'wma', category: 'audio' },
        'm4a': { type: 'M4A Audio', ext: 'm4a', category: 'audio' },
        'mid': { type: 'MIDI', ext: 'mid', category: 'audio' },
        'midi': { type: 'MIDI', ext: 'midi', category: 'audio' },
        
        // –í–∏–¥–µ–æ
        'mp4': { type: 'MP4 Video', ext: 'mp4', category: 'video' },
        'avi': { type: 'AVI Video', ext: 'avi', category: 'video' },
        'mkv': { type: 'MKV Video', ext: 'mkv', category: 'video' },
        'mov': { type: 'MOV Video', ext: 'mov', category: 'video' },
        'wmv': { type: 'WMV Video', ext: 'wmv', category: 'video' },
        'flv': { type: 'FLV Video', ext: 'flv', category: 'video' },
        'webm': { type: 'WebM Video', ext: 'webm', category: 'video' },
        'mpg': { type: 'MPEG Video', ext: 'mpg', category: 'video' },
        'mpeg': { type: 'MPEG Video', ext: 'mpeg', category: 'video' },
        '3gp': { type: '3GP Video', ext: '3gp', category: 'video' },
        
        // –î–æ–∫—É–º–µ–Ω—Ç—ã
        'pdf': { type: 'PDF Document', ext: 'pdf', category: 'document' },
        'doc': { type: 'Word Document', ext: 'doc', category: 'document' },
        'docx': { type: 'Word Document', ext: 'docx', category: 'document' },
        'xls': { type: 'Excel Spreadsheet', ext: 'xls', category: 'document' },
        'xlsx': { type: 'Excel Spreadsheet', ext: 'xlsx', category: 'document' },
        'ppt': { type: 'PowerPoint', ext: 'ppt', category: 'document' },
        'pptx': { type: 'PowerPoint', ext: 'pptx', category: 'document' },
        'rtf': { type: 'RTF Document', ext: 'rtf', category: 'document' },
        'txt': { type: 'Text File', ext: 'txt', category: 'text' },
        'odt': { type: 'OpenDocument Text', ext: 'odt', category: 'document' },
        'ods': { type: 'OpenDocument Spreadsheet', ext: 'ods', category: 'document' },
        'odp': { type: 'OpenDocument Presentation', ext: 'odp', category: 'document' },
        
        // –í–µ–±-—Ñ–∞–π–ª—ã
        'html': { type: 'HTML Document', ext: 'html', category: 'web' },
        'htm': { type: 'HTML Document', ext: 'htm', category: 'web' },
        'css': { type: 'CSS Stylesheet', ext: 'css', category: 'web' },
        'js': { type: 'JavaScript', ext: 'js', category: 'web' },
        'json': { type: 'JSON Data', ext: 'json', category: 'web' },
        'xml': { type: 'XML Document', ext: 'xml', category: 'web' },
        'php': { type: 'PHP Script', ext: 'php', category: 'web' },
        
        // –ê—Ä—Ö–∏–≤—ã
        'zip': { type: 'ZIP Archive', ext: 'zip', category: 'archive' },
        'rar': { type: 'RAR Archive', ext: 'rar', category: 'archive' },
        '7z': { type: '7-Zip Archive', ext: '7z', category: 'archive' },
        'tar': { type: 'TAR Archive', ext: 'tar', category: 'archive' },
        'gz': { type: 'GZIP Archive', ext: 'gz', category: 'archive' },
        'bz2': { type: 'BZIP2 Archive', ext: 'bz2', category: 'archive' },
        
        // –ò—Å–ø–æ–ª–Ω—è–µ–º—ã–µ
        'exe': { type: 'Windows Executable', ext: 'exe', category: 'executable' },
        'msi': { type: 'Windows Installer', ext: 'msi', category: 'executable' },
        'app': { type: 'macOS Application', ext: 'app', category: 'executable' },
        'deb': { type: 'Debian Package', ext: 'deb', category: 'executable' },
        'rpm': { type: 'RPM Package', ext: 'rpm', category: 'executable' },
        'bat': { type: 'Batch Script', ext: 'bat', category: 'executable' },
        'sh': { type: 'Shell Script', ext: 'sh', category: 'executable' },
        'cmd': { type: 'Command Script', ext: 'cmd', category: 'executable' }
      };
      
      return extMap[ext] || null;
    }

    let currentFileName = null; // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º –∏–º—è –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞

    // –£–º–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞ —Å —É—á—ë—Ç–æ–º –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
    function detectFileType(hexData, filename = null) {
      const hex = hexData.toUpperCase();
      
      // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫—É (HEX)
      const sortedSigs = Object.keys(fileSignatures)
        .sort((a, b) => b.length - a.length);
      
      let hexDetection = null;
      for (const signature of sortedSigs) {
        if (hex.startsWith(signature)) {
          const info = fileSignatures[signature];
          
          // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–ª—è –Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω—ã—Ö —Å–∏–≥–Ω–∞—Ç—É—Ä
          if (info.needsCheck && signature === '52494646') {
            if (hex.indexOf('57454250') > 0) {
              hexDetection = { ...info, type: 'WebP', ext: 'webp' };
            } else if (hex.indexOf('57415645') > 0) {
              hexDetection = { ...info, type: 'WAV Audio', ext: 'wav' };
            } else if (hex.indexOf('41564920') > 0) {
              hexDetection = { ...info, type: 'AVI Video', ext: 'avi' };
            } else {
              hexDetection = info;
            }
          } else if (signature === '504B0304') {
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ Office —Ñ–æ—Ä–º–∞—Ç–æ–≤ –≤ ZIP
            if (hex.indexOf('776F7264') > 0 || hex.indexOf('646F6378') > 0) {
              hexDetection = { ...info, type: 'DOCX Document', ext: 'docx' };
            } else if (hex.indexOf('786C7378') > 0 || hex.indexOf('656C') > 0) {
              hexDetection = { ...info, type: 'XLSX Spreadsheet', ext: 'xlsx' };
            } else if (hex.indexOf('70707478') > 0) {
              hexDetection = { ...info, type: 'PPTX Presentation', ext: 'pptx' };
            } else {
              hexDetection = info;
            }
          } else if (signature === '2F2A') {
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ CSS/JS
            if (hex.indexOf('2A2F') > 0 && hex.indexOf('626F6479') === -1) {
              hexDetection = { ...info, type: 'CSS', ext: 'css' };
            } else {
              hexDetection = { ...info, type: 'JavaScript', ext: 'js' };
            }
          } else {
            hexDetection = info;
          }
          break;
        }
      }
      
      // –¢–µ–ø–µ—Ä—å –ø—Ä–æ–±—É–µ–º –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é —Ñ–∞–π–ª–∞
      let extDetection = null;
      if (filename) {
        const fileExt = getFileExtension(filename);
        if (fileExt) {
          extDetection = getTypeByExtension(fileExt);
        }
      }
      
      // –õ–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:
      // 1. –ï—Å–ª–∏ –∏ HEX –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç - –æ—Ç–ª–∏—á–Ω–æ!
      // 2. –ï—Å–ª–∏ HEX –æ–ø—Ä–µ–¥–µ–ª–∏–ª—Å—è, –Ω–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç - –¥–æ–≤–µ—Ä—è–µ–º HEX, –Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
      // 3. –ï—Å–ª–∏ —Ç–æ–ª—å–∫–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª–∏–ª–æ—Å—å - –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ
      // 4. –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–∏–ª–æ—Å—å - –ø—Ä–æ–±—É–µ–º —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª
      
      if (hexDetection && extDetection) {
        if (hexDetection.ext === extDetection.ext) {
          return { ...hexDetection, confidence: '–≤—ã—Å–æ–∫–∞—è', source: '–∑–∞–≥–æ–ª–æ–≤–æ–∫ + —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ' };
        } else {
          return { 
            ...hexDetection, 
            confidence: '—Å—Ä–µ–¥–Ω—è—è', 
            source: '–∑–∞–≥–æ–ª–æ–≤–æ–∫ (—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç)',
            expectedExt: extDetection.ext
          };
        }
      } else if (hexDetection) {
        return { ...hexDetection, confidence: '—Å—Ä–µ–¥–Ω—è—è', source: '–∑–∞–≥–æ–ª–æ–≤–æ–∫ —Ñ–∞–π–ª–∞' };
      } else if (extDetection) {
        return { ...extDetection, confidence: '–Ω–∏–∑–∫–∞—è', source: '—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ–∞–π–ª–∞' };
      }
      
      // Fallback - –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª
      if (isLikelyText(hexData)) {
        return { type: 'Text File', ext: 'txt', category: 'text', confidence: '–Ω–∏–∑–∫–∞—è', source: '–∞–Ω–∞–ª–∏–∑ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ' };
      }
      
      return { type: 'Unknown Format', ext: 'bin', category: 'unknown', confidence: '–Ω–µ—Ç', source: '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ' };
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª
    function isLikelyText(hexData) {
      const hex = hexData.toUpperCase();
      const bytes = hex.match(/.{2}/g) || [];
      
      if (bytes.length < 10) return false;
      
      let textChars = 0;
      for (let i = 0; i < Math.min(bytes.length, 100); i++) {
        const byte = parseInt(bytes[i], 16);
        if ((byte >= 0x20 && byte <= 0x7E) || byte === 0x09 || byte === 0x0A || byte === 0x0D) {
          textChars++;
        }
      }
      
      return (textChars / Math.min(bytes.length, 100)) > 0.7;
    }

    // –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤
    function validateFile(hexData, fileInfo) {
      const hex = hexData.toUpperCase();
      
      // –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ —Ç–∏–ø–∞–º —Ñ–∞–π–ª–æ–≤
      switch (fileInfo.category) {
        case 'image':
          if (fileInfo.ext === 'jpg' && hex.startsWith('FFD8')) {
            return hex.includes('FFD9') ? '–≤–∞–ª–∏–¥–Ω—ã–π' : '–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω (–Ω–µ—Ç EOF)';
          }
          if (fileInfo.ext === 'png' && hex.startsWith('89504E47')) {
            return hex.includes('49454E44AE426082') ? '–≤–∞–ª–∏–¥–Ω—ã–π' : '–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω';
          }
          if (fileInfo.ext === 'gif' && hex.startsWith('474946')) {
            return hex.includes('003B') || hex.includes('21') ? '–≤–∞–ª–∏–¥–Ω—ã–π' : '–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω';
          }
          break;
          
        case 'document':
          if (fileInfo.ext === 'pdf' && hex.startsWith('25504446')) {
            return hex.includes('454O46') || hex.includes('2525454F46') ? '–≤–∞–ª–∏–¥–Ω—ã–π' : '–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω';
          }
          break;
          
        case 'archive':
          if (fileInfo.ext === 'zip' && hex.startsWith('504B')) {
            return hex.length > 60 ? '–≤–∞–ª–∏–¥–Ω—ã–π' : '—Å–ª–∏—à–∫–æ–º –º–∞–ª';
          }
          break;
      }
      
      // –û–±—â–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞
      const size = hex.length / 2;
      if (size < 10) return '—Å–ª–∏—à–∫–æ–º –º–∞–ª';
      if (size > 1000000) return '–æ—á–µ–Ω—å –±–æ–ª—å—à–æ–π';
      
      return '–ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ –≤–∞–ª–∏–¥–Ω—ã–π';
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
    function showPreview(hexData, fileType) {
      previewContent.innerHTML = '';
      
      // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º HEX –≤ –±–∏–Ω–∞—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
      let hex = hexData.replace(/\s+/g, '').toUpperCase();
      if (hex.length % 2 !== 0) {
        hex = '0' + hex;
      }
      
      const bytes = new Uint8Array(hex.match(/.{2}/g).map(h => parseInt(h, 16)));
      const blob = new Blob([bytes]);
      const url = URL.createObjectURL(blob);
      
      // –í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
      switch (fileType.category) {
        case 'image':
          const img = document.createElement('img');
          img.src = url;
          img.classList.add('preview-image');
          img.onload = () => URL.revokeObjectURL(url);
          previewContent.appendChild(img);
          break;
          
        case 'audio':
          const audio = document.createElement('audio');
          audio.controls = true;
          audio.src = url;
          audio.classList.add('preview-audio');
          previewContent.appendChild(audio);
          break;
          
        case 'video':
          const video = document.createElement('video');
          video.controls = true;
          video.src = url;
          video.classList.add('preview-video');
          previewContent.appendChild(video);
          break;
          
        case 'text':
        case 'web':
        case 'document':
          // –î–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤ –ø—ã—Ç–∞–µ–º—Å—è –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
          const reader = new FileReader();
          reader.onload = function(e) {
            const text = e.target.result;
            const pre = document.createElement('pre');
            pre.classList.add('preview-text');
            pre.textContent = text;
            previewContent.appendChild(pre);
            URL.revokeObjectURL(url);
          };
          reader.readAsText(blob);
          break;
          
        default:
          previewContent.innerHTML = `
            <div class="preview-unsupported">
              <p>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞ —Ñ–∞–π–ª–æ–≤ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è</p>
              <p>–¢–∏–ø: ${fileType.type} (${fileType.ext})</p>
              <p>–†–∞–∑–º–µ—Ä: ${bytes.length} –±–∞–π—Ç</p>
            </div>
          `;
          URL.revokeObjectURL(url);
      }
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–∫–Ω–æ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
      previewOverlay.classList.add('active');
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞
    fileInput.addEventListener('change', () => {
      const file = fileInput.files[0];
      if (!file) return;
      
      currentFileName = file.name; // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º –∏–º—è —Ñ–∞–π–ª–∞
      fileInfo.innerHTML = `<span class="loading">${currentLang === 'ru' ? '–ó–∞–≥—Ä—É–∑–∫–∞:' : 'Loading:'} ${file.name} (${file.size} ${currentLang === 'ru' ? '–±–∞–π—Ç' : 'bytes'})...</span>`;
      
      const reader = new FileReader();
      reader.onload = e => {
        const bytes = new Uint8Array(e.target.result);
        const hexString = Array.from(bytes)
          .map(x => x.toString(16).padStart(2, '0'))
          .join(' ');
        hexArea.value = hexString;
        
        // –°—Ä–∞–∑—É –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
        const detectedInfo = detectFileType(hexString.replace(/\s+/g, ''), currentFileName);
        const validation = validateFile(hexString.replace(/\s+/g, ''), detectedInfo);
        
        let warningText = '';
        if (detectedInfo.expectedExt) {
          warningText = `<br><small style="color: #ff9800;">‚ö†Ô∏è ${currentLang === 'ru' ? '–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ–∞–π–ª–∞' : 'File extension'} (${getFileExtension(currentFileName)}) ${currentLang === 'ru' ? '–Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Å–æ–¥–µ—Ä–∂–∏–º—ã–º' : 'does not match content'}</small>`;
        }
        
        fileInfo.innerHTML = `
          ${currentLang === 'ru' ? '–§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω' : 'File loaded'}: <strong>${file.name}</strong><br>
          ${currentLang === 'ru' ? '–†–∞–∑–º–µ—Ä' : 'Size'}: ${file.size} ${currentLang === 'ru' ? '–±–∞–π—Ç' : 'bytes'}<br>
          <strong>${currentLang === 'ru' ? '–û–ø—Ä–µ–¥–µ–ª—ë–Ω –∫–∞–∫' : 'Detected as'}:</strong> ${detectedInfo.type} (.${detectedInfo.ext})<br>
          <strong>${currentLang === 'ru' ? '–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å' : 'Confidence'}:</strong> ${currentLang === 'ru' ? detectedInfo.confidence : 
            detectedInfo.confidence === '–≤—ã—Å–æ–∫–∞—è' ? 'high' : 
            detectedInfo.confidence === '—Å—Ä–µ–¥–Ω—è—è' ? 'medium' : 
            detectedInfo.confidence === '–Ω–∏–∑–∫–∞—è' ? 'low' : 'none'}${warningText}
        `;
      };
      reader.readAsArrayBuffer(file);
    });

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞
    document.getElementById('checkBtn').addEventListener('click', () => {
      let hex = hexArea.value.replace(/\s+/g, '').toUpperCase();
      
      if (hex.length === 0) {
        return alert(currentLang === 'ru' ? '–í–≤–µ–¥–∏—Ç–µ HEX –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏' : 'Enter HEX data to check');
      }
      
      if (!hex.match(/^[0-9A-F]*$/)) {
        return alert(currentLang === 'ru' ? '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ HEX —Å–∏–º–≤–æ–ª—ã! –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ 0-9 –∏ A-F' : 'Invalid HEX characters! Use only 0-9 and A-F');
      }
      
      if (hex.length < 8) {
        return alert(currentLang === 'ru' ? '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–∏–ø–∞ (–º–∏–Ω–∏–º—É–º 4 –±–∞–π—Ç–∞)' : 'Not enough data to determine type (minimum 4 bytes)');
      }
      
      const detectedInfo = detectFileType(hex, currentFileName);
      const validation = validateFile(hex, detectedInfo);
      
      fileInfo.innerHTML = `
        <strong>${currentLang === 'ru' ? '–¢–∏–ø' : 'Type'}:</strong> ${detectedInfo.type}<br>
        <strong>${currentLang === 'ru' ? '–ö–∞—Ç–µ–≥–æ—Ä–∏—è' : 'Category'}:</strong> ${detectedInfo.category}<br>
        <strong>${currentLang === 'ru' ? '–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ' : 'Extension'}:</strong> .${detectedInfo.ext}<br>
        <strong>${currentLang === 'ru' ? '–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å' : 'Confidence'}:</strong> ${currentLang === 'ru' ? detectedInfo.confidence : 
          detectedInfo.confidence === '–≤—ã—Å–æ–∫–∞—è' ? 'high' : 
          detectedInfo.confidence === '—Å—Ä–µ–¥–Ω—è—è' ? 'medium' : 
          detectedInfo.confidence === '–Ω–∏–∑–∫–∞—è' ? 'low' : 'none'}<br>
        <strong>${currentLang === 'ru' ? '–ò—Å—Ç–æ—á–Ω–∏–∫' : 'Source'}:</strong> ${currentLang === 'ru' ? detectedInfo.source : 
          detectedInfo.source === '–∑–∞–≥–æ–ª–æ–≤–æ–∫ + —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ' ? 'header + extension' :
          detectedInfo.source === '–∑–∞–≥–æ–ª–æ–≤–æ–∫ (—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç)' ? 'header (extension mismatch)' :
          detectedInfo.source === '–∑–∞–≥–æ–ª–æ–≤–æ–∫ —Ñ–∞–π–ª–∞' ? 'file header' :
          detectedInfo.source === '—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ–∞–π–ª–∞' ? 'file extension' :
          detectedInfo.source === '–∞–Ω–∞–ª–∏–∑ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ' ? 'content analysis' : 'unknown'}<br>
        <strong>${currentLang === 'ru' ? '–°–æ—Å—Ç–æ—è–Ω–∏–µ' : 'Status'}:</strong> <span class="${validation.includes('–≤–∞–ª–∏–¥–Ω—ã–π') ? 'valid' : validation.includes('–ø–æ–≤—Ä–µ–∂–¥–µ–Ω') ? 'invalid' : ''}">${currentLang === 'ru' ? validation : 
          validation === '–≤–∞–ª–∏–¥–Ω—ã–π' ? 'valid' :
          validation === '–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω (–Ω–µ—Ç EOF)' ? 'possibly corrupted (no EOF)' :
          validation === '–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω' ? 'possibly corrupted' :
          validation === '—Å–ª–∏—à–∫–æ–º –º–∞–ª' ? 'too small' :
          validation === '–æ—á–µ–Ω—å –±–æ–ª—å—à–æ–π' ? 'very large' :
          validation === '–ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ –≤–∞–ª–∏–¥–Ω—ã–π' ? 'presumably valid' : validation}</span><br>
        <strong>${currentLang === 'ru' ? '–†–∞–∑–º–µ—Ä' : 'Size'}:</strong> ${hex.length / 2} ${currentLang === 'ru' ? '–±–∞–π—Ç' : 'bytes'}
        <div class="extension-info">üí° ${currentLang === 'ru' ? '–§–∞–π–ª –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω –∫–∞–∫' : 'File will be saved as'} output.${detectedInfo.ext}</div>
      `;
    });

    // –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ñ–∞–π–ª–∞
    previewBtn.addEventListener('click', () => {
      let hex = hexArea.value.replace(/\s+/g, '').toUpperCase();
      
      if (hex.length === 0) {
        return alert(currentLang === 'ru' ? '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞' : 'No data to preview');
      }
      
      if (!hex.match(/^[0-9A-F]*$/)) {
        return alert(currentLang === 'ru' ? '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ HEX —Å–∏–º–≤–æ–ª—ã! –û—á–∏—Å—Ç–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞' : 'Invalid HEX characters! Clear the data and try again');
      }
      
      if (hex.length < 8) {
        return alert(currentLang === 'ru' ? '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞' : 'Not enough data for preview');
      }
      
      const detectedInfo = detectFileType(hex, currentFileName);
      showPreview(hexArea.value, detectedInfo);
    });

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –æ–∫–Ω–∞ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
    previewClose.addEventListener('click', () => {
      previewOverlay.classList.remove('active');
    });

    // –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ —Å —É–º–Ω—ã–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
    document.getElementById('downloadBtn').addEventListener('click', () => {
      let hex = hexArea.value.replace(/\s+/g, '').toUpperCase();
      
      if (hex.length === 0) {
        return alert(currentLang === 'ru' ? '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è' : 'No data to download');
      }
      
      if (!hex.match(/^[0-9A-F]*$/)) {
        return alert(currentLang === 'ru' ? '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ HEX —Å–∏–º–≤–æ–ª—ã! –û—á–∏—Å—Ç–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞' : 'Invalid HEX characters! Clear the data and try again');
      }
      
      if (hex.length % 2 !== 0) {
        hex = '0' + hex;
        alert(currentLang === 'ru' ? '–î–æ–±–∞–≤–ª–µ–Ω –≤–µ–¥—É—â–∏–π –Ω–æ–ª—å –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å –±–∞–π—Ç–∞–º–∏' : 'Leading zero added for proper byte handling');
      }
      
      try {
        const bytes = new Uint8Array(
          hex.match(/.{2}/g).map(h => parseInt(h, 16))
        );
        
        const detectedInfo = detectFileType(hex, currentFileName);
        const validation = validateFile(hex, detectedInfo);
        
        // –°–æ–∑–¥–∞—ë–º —Ñ–∞–π–ª —Å –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º
        const blob = new Blob([bytes]);
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `output.${detectedInfo.ext}`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(a.href);
        
        fileInfo.innerHTML = `
          <span class="valid">‚úì ${currentLang === 'ru' ? '–§–∞–π–ª —Å–∫–∞—á–∞–Ω –∫–∞–∫' : 'File downloaded as'} output.${detectedInfo.ext}</span><br>
          <small>${currentLang === 'ru' ? '–¢–∏–ø' : 'Type'}: ${detectedInfo.type} | ${currentLang === 'ru' ? '–°–æ—Å—Ç–æ—è–Ω–∏–µ' : 'Status'}: ${currentLang === 'ru' ? validation : 
            validation === '–≤–∞–ª–∏–¥–Ω—ã–π' ? 'valid' :
            validation === '–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω (–Ω–µ—Ç EOF)' ? 'possibly corrupted (no EOF)' :
            validation === '–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω' ? 'possibly corrupted' :
            validation === '—Å–ª–∏—à–∫–æ–º –º–∞–ª' ? 'too small' :
            validation === '–æ—á–µ–Ω—å –±–æ–ª—å—à–æ–π' ? 'very large' :
            validation === '–ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ –≤–∞–ª–∏–¥–Ω—ã–π' ? 'presumably valid' : validation}</small>
        `;
        
      } catch (error) {
        alert((currentLang === 'ru' ? '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ñ–∞–π–ª–∞: ' : 'Error creating file: ') + error.message);
      }
    });

    // –û—á–∏—Å—Ç–∫–∞
    document.getElementById('clearBtn').addEventListener('click', () => {
      hexArea.value = '';
      fileInput.value = '';
      currentFileName = null; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∏–º—è —Ñ–∞–π–ª–∞
      fileInfo.textContent = currentLang === 'ru' ? '–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ HEX –¥–∞–Ω–Ω—ã–µ' : 'Select a file or enter HEX data';
    });

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø—Ä–∏ –≤–≤–æ–¥–µ
    hexArea.addEventListener('input', () => {
      const hex = hexArea.value.replace(/\s+/g, '');
      if (hex.length > 0) {
        const bytes = hex.length / 2;
        fileInfo.innerHTML = `${currentLang === 'ru' ? 'HEX –¥–∞–Ω–Ω—ã—Ö' : 'HEX data'}: ${bytes} ${currentLang === 'ru' ? '–±–∞–π—Ç' : 'bytes'}${bytes > 8 ? 
          ` <small>(${currentLang === 'ru' ? '–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞' : 'enough for analysis'})</small>` : 
          ` <small>(${currentLang === 'ru' ? '–º–∞–ª–æ –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è' : 'too little for accurate detection'})</small>`}`;
      }
    });
  </script>
</body>
</html>
